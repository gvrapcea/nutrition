<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script>

var bc; // BMI Calculator Object
var percentileHelper; // Percentile Object

var kh_current_month;
var kh_current_year;

// If Server_Month is undefined, get the current year via the client
if(typeof Server_Month !== 'undefined') {
	kh_current_month = Server_Month;
} else {
	var d = new Date();
	kh_current_month = d.getMonth() + 1;

	if(parseInt(kh_current_month) < 10) {
		kh_current_month = "0" + parseInt(kh_current_month);
	}
}

// If Server_Year is undefined, get the current year via the client
if(typeof Server_Year !== 'undefined') {
	kh_current_year = Server_Year;
} else if(typeof KHcopyDate !== 'undefined') {
	kh_current_year = KHcopyDate;
} else {
	var d = new Date();
	kh_current_year = d.getFullYear();
}

var Percentile = function() {
	// Sets up all the percentile data
	this.setup = function() {
		var boys_bmi = new Array('24|-1.982373595|16.54777487|0.080127429|14.71929257|18.11954923', '25|-1.924100169|16.49442763|0.079233994|14.68360841|18.03668013', '26|-1.86549793|16.44259552|0.078389356|14.64843329|17.95700228', '27|-1.807261899|16.3922434|0.077593501|14.61378626|17.88047101', '28|-1.750118905|16.34333654|0.076846462|14.57968578|17.80704259', '29|-1.69481584|16.29584097|0.076148308|14.54614966|17.73667414', '30|-1.642106779|16.24972371|0.075499126|14.51319492|17.66932346', '31|-1.592744414|16.20495268|0.074898994|14.48083795|17.6049486', '32|-1.547442391|16.16149871|0.074347997|14.44909329|17.54350898', '33|-1.506902601|16.11933258|0.073846139|14.41797561|17.48496295', '34|-1.471770047|16.07842758|0.07339337|14.38749811|17.42926933', '35|-1.442628957|16.03875896|0.072989551|14.35767293|17.37638677', '36|-1.419991255|16.00030401|0.072634432|14.32851119|17.32627356', '37|-1.404277619|15.96304277|0.072327649|14.30002256|17.27888795', '38|-1.39586317|15.92695418|0.07206864|14.27221761|17.23418554', '39|-1.394935252|15.89202582|0.071856805|14.24510202|17.19212545', '40|-1.401671596|15.85824093|0.071691278|14.21868433|17.15266201', '41|-1.416100312|15.82558822|0.071571093|14.19297011|17.11575098', '42|-1.438164899|15.79405728|0.071495113|14.16796472|17.08134677', '43|-1.467669032|15.76364255|0.071462106|14.14367089|17.04940504', '44|-1.504376347|15.73433668|0.071470646|14.12009269|17.0198786', '45|-1.547942838|15.70613566|0.071519218|14.09723246|16.99272087', '46|-1.597896397|15.67904062|0.071606277|14.07508966|16.96788739', '47|-1.653732283|15.65305192|0.071730167|14.05366443|16.94533215', '48|-1.714869347|15.62817269|0.071889214|14.03295533|16.92501028', '49|-1.780673181|15.604408|0.072081737|14.01295984|16.90687779', '50|-1.850468473|15.58176458|0.072306081|13.99367445|16.89089179', '51|-1.923551865|15.56025067|0.072560637|13.97509464|16.87701073', '52|-1.999220429|15.5398746|0.07284384|13.95721572|16.86519374', '53|-2.076707178|15.52064993|0.073154324|13.94002947|16.85540483', '54|-2.155348017|15.50258427|0.073490667|13.92353116|16.8476049', '55|-2.234438552|15.48568973|0.073851672|13.90771281|16.84175987', '56|-2.313321723|15.46997718|0.074236235|13.89256678|16.8378366', '57|-2.391381273|15.45545692|0.074643374|13.87808525|16.83580365', '58|-2.468032491|15.44213961|0.075072264|13.86425959|16.83563223', '59|-2.542781541|15.43003207|0.075522104|13.85108308|16.83729272', '60|-2.61516595|15.41914163|0.07599225|13.83854804|16.84075838', '61|-2.684789516|15.40947356|0.076482128|13.82664746|16.84600319', '62|-2.751316949|15.40103139|0.076991232|13.81537489|16.85300198', '63|-2.81445945|15.39381785|0.077519149|13.8047237|16.86173124', '64|-2.87402476|15.38783094|0.07806539|13.79469004|16.87216519', '65|-2.92984048|15.38306945|0.078629592|13.78526882|16.88428085', '66|-2.981796828|15.37952958|0.079211369|13.77645627|16.89805459', '67|-3.029831343|15.37720582|0.079810334|13.76824936|16.91346275', '68|-3.073924224|15.37609107|0.080426086|13.76064574|16.93048153', '69|-3.114093476|15.37617677|0.081058206|13.75364373|16.94908693', '70|-3.15039004|15.37745304|0.081706249|13.7472423|16.96925461', '71|-3.182893018|15.37990886|0.082369741|13.74144099|16.99095993', '72|-3.21170511|15.38353217|0.083048178|13.73623987|17.01417786', '73|-3.23694834|15.38831005|0.083741021|13.73163946|17.03888299', '74|-3.25876011|15.39422883|0.0844477|13.72764072|17.06504953', '75|-3.277281546|15.40127496|0.085167651|13.72424433|17.09265223', '76|-3.292683774|15.40943252|0.085900184|13.72145289|17.12166319', '77|-3.305124073|15.41868691|0.086644667|13.71926775|17.15205629', '78|-3.314768951|15.42902273|0.087400421|13.71769094|17.18380454', '79|-3.321785992|15.44042439|0.088166744|13.71672458|17.21688072', '80|-3.326345795|15.45287581|0.088942897|13.71637124|17.25125697', '81|-3.328602731|15.46636218|0.089728202|13.71663233|17.28690708', '82|-3.328725277|15.48086704|0.090521875|13.71751078|17.32380254', '83|-3.32687018|15.49637465|0.091323162|13.71900887|17.3619157', '84|-3.323188896|15.51286936|0.092131305|13.72112886|17.40121891', '85|-3.317827016|15.53033563|0.092945544|13.72387293|17.44168456', '86|-3.310923871|15.54875807|0.093765118|13.72724315|17.48328513', '87|-3.302612272|15.56812143|0.09458927|13.7312415|17.52599317', '88|-3.293018361|15.58841065|0.095417247|13.73586983|17.56978138', '89|-3.282260813|15.60961101|0.096248301|13.7411299|17.61462266', '90|-3.270454609|15.63170735|0.097081694|13.74702309|17.66048985', '91|-3.257703616|15.65468563|0.097916698|13.753551|17.70735632', '92|-3.244108214|15.67853139|0.098752593|13.7607148|17.75519541', '93|-3.229761713|15.70323052|0.099588675|13.76851558|17.80398077', '94|-3.214751287|15.72876911|0.100424251|13.77695423|17.85368626', '95|-3.199158184|15.75513347|0.101258643|13.78603145|17.90428602', '96|-3.18305795|15.78231007|0.102091189|13.79574779|17.95575444', '97|-3.166520664|15.8102856|0.102921245|13.80610355|18.00806622', '98|-3.1496103|15.83904708|0.103748189|13.81709878|18.06119653', '99|-3.132389637|15.86858123|0.104571386|13.82873375|18.1151201', '100|-3.114911153|15.89887562|0.105390269|13.84100784|18.16981303', '101|-3.097226399|15.92991765|0.106204258|13.85392068|18.22525119', '102|-3.079383079|15.96169481|0.107012788|13.86747174|18.28141055', '103|-3.061423765|15.99419489|0.107815327|13.88166013|18.33826774', '104|-3.043386071|16.02740607|0.108611374|13.89648454|18.39579999', '105|-3.025310003|16.0613159|0.109400388|13.91194439|18.45398355', '106|-3.007225737|16.09591292|0.110181915|13.92803786|18.51279647', '107|-2.989164598|16.13118532|0.110955478|13.94476358|18.57221621', '108|-2.971148225|16.16712234|0.111720691|13.9621189|18.63222223', '109|-2.953208047|16.20371168|0.112477059|13.98010297|18.69279128', '110|-2.935363951|16.24094239|0.1132242|13.99871328|18.75390266', '111|-2.917635157|16.27880346|0.113961734|14.01794738|18.81553565', '112|-2.900039803|16.31728385|0.114689291|14.03780282|18.87766958', '113|-2.882593796|16.35637267|0.115406523|14.0582769|18.94028419', '114|-2.865311266|16.39605916|0.116113097|14.07936677|19.00335954', '115|-2.848204697|16.43633265|0.116808702|14.10106937|19.06687603', '116|-2.831285052|16.47718256|0.117493042|14.1233815|19.13081436', '117|-2.81456189|16.51859843|0.11816584|14.14629977|19.19515554', '118|-2.79804347|16.56056987|0.118826835|14.16982063|19.25988094', '119|-2.781736856|16.60308661|0.119475785|14.19394037|19.3249722', '120|-2.765648008|16.64613844|0.120112464|14.21865508|19.3904113', '121|-2.749782197|16.68971518|0.120736656|14.24396081|19.45618042', '122|-2.734142443|16.73380695|0.121348181|14.26985313|19.52226247', '123|-2.718732873|16.77840363|0.121946849|14.29632789|19.58864006', '124|-2.703555506|16.82349538|0.122532501|14.32338048|19.65529649', '125|-2.688611957|16.86907238|0.123104991|14.35100623|19.72221531', '126|-2.673903164|16.91512487|0.123664186|14.37920031|19.78938034', '127|-2.659429443|16.96164317|0.124209969|14.40795771|19.85677572', '128|-2.645190534|17.00861766|0.124742239|14.43727329|19.92438591', '129|-2.631185649|17.05603879|0.125260905|14.46714175|19.99219565', '130|-2.617413511|17.10389705|0.125765895|14.49755765|20.06019002', '131|-2.603872392|17.15218302|0.126257147|14.52851537|20.12835437', '132|-2.590560148|17.20088732|0.126734613|14.56000917|20.19667437', '133|-2.577474253|17.25000062|0.12719826|14.59203313|20.265136', '134|-2.564611831|17.29951367|0.127648067|14.62458122|20.33372554', '135|-2.551969684|17.34941726|0.128084023|14.65764722|20.40242956', '136|-2.539539972|17.39970308|0.128506192|14.69122381|20.4712365', '137|-2.527325681|17.45036072|0.128914497|14.72530601|20.54013114', '138|-2.515320235|17.50138161|0.129309001|14.75988661|20.60910189', '139|-2.503519447|17.55275674|0.129689741|14.79495883|20.6781365', '140|-2.491918934|17.60447714|0.130056765|14.83051578|20.74722303', '141|-2.480514136|17.6565339|0.130410133|14.86655039|20.81634983', '142|-2.469300331|17.70891811|0.130749913|14.90305549|20.88550554', '143|-2.458272656|17.76162094|0.131076187|14.94002374|20.95467909', '144|-2.447426113|17.81463359|0.131389042|14.97744768|21.02385969', '145|-2.436755595|17.86794729|0.131688579|15.01531973|21.09303687', '146|-2.426255887|17.92155332|0.131974905|15.05363215|21.1622004', '147|-2.415921689|17.97544299|0.132248138|15.09237707|21.23134038', '148|-2.405747619|18.02960765|0.132508403|15.13154651|21.30044717', '149|-2.395728233|18.08403868|0.132755834|15.17113234|21.36951141', '150|-2.385858029|18.1387275|0.132990575|15.2111263|21.43852405', '151|-2.376131459|18.19366555|0.133212776|15.25152001|21.5074763', '152|-2.366542942|18.24884431|0.133422595|15.29230496|21.57635964', '153|-2.357086871|18.3042553|0.133620197|15.33347251|21.64516586', '154|-2.347757625|18.35989003|0.133805756|15.37501389|21.71388701', '155|-2.338549576|18.41574009|0.133979452|15.41692023|21.78251541', '156|-2.3294571|18.47179706|0.13414147|15.4591825|21.85104367', '157|-2.320474586|18.52805255|0.134292005|15.50179159|21.91946467', '158|-2.311596446|18.5844982|0.134431256|15.54473823|21.98777156', '159|-2.302817124|18.64112567|0.134559427|15.58801305|22.05595776', '160|-2.294131107|18.69792663|0.134676731|15.63160658|22.12401698', '161|-2.285532933|18.75489278|0.134783385|15.67550919|22.19194317', '162|-2.277017201|18.81201584|0.134879611|15.71971118|22.25973057', '163|-2.268578584|18.86928753|0.134965637|15.7642027|22.32737368', '164|-2.260211837|18.92669959|0.135041695|15.80897382|22.39486727', '165|-2.251911809|18.98424378|0.135108024|15.85401448|22.46220636', '166|-2.243673453|19.04191185|0.135164867|15.89931451|22.52938625', '167|-2.235491842|19.09969557|0.135212469|15.94486363|22.5964025', '168|-2.227362173|19.15758672|0.135251083|15.99065148|22.66325092', '169|-2.21927979|19.21557707|0.135280963|16.03666757|22.7299276', '170|-2.211240187|19.27365839|0.135302371|16.0829013|22.79642886', '171|-2.203239029|19.33182247|0.135315568|16.129342|22.86275131', '172|-2.195272161|19.39006106|0.135320824|16.17597888|22.92889179', '173|-2.187335625|19.44836594|0.135318407|16.22280106|22.99484741', '174|-2.179425674|19.50672885|0.135308594|16.26979755|23.06061552', '175|-2.171538789|19.56514153|0.135291662|16.31695728|23.12619375', '176|-2.163671689|19.62359571|0.135267891|16.3642691|23.19157996', '177|-2.155821357|19.6820831|0.135237567|16.41172173|23.25677226', '178|-2.147985046|19.74059538|0.135200976|16.45930384|23.32176902', '179|-2.140160305|19.7991242|0.135158409|16.50700399|23.38656886', '180|-2.132344989|19.85766121|0.135110159|16.55481067|23.45117065', '181|-2.124537282|19.916198|0.135056522|16.60271228|23.5155735', '182|-2.116735712|19.97472615|0.134997797|16.65069714|23.57977678', '183|-2.108939167|20.03323719|0.134934285|16.69875348|23.6437801', '184|-2.10114692|20.09172262|0.134866291|16.74686947|23.70758332', '185|-2.093358637|20.15017387|0.134794121|16.79503318|23.77118654', '186|-2.085574403|20.20858236|0.134718085|16.84323264|23.83459013', '187|-2.077794735|20.26693944|0.134638494|16.89145577|23.89779468', '188|-2.070020599|20.32523642|0.134555663|16.93969043|23.96080104', '189|-2.062253431|20.38346455|0.13446991|16.98792443|24.02361032', '190|-2.054495145|20.44161501|0.134381553|17.03614547|24.08622386', '191|-2.046748156|20.49967894|0.134290916|17.08434122|24.14864327', '192|-2.039015385|20.5576474|0.134198323|17.13249925|24.21087038', '193|-2.031300282|20.6155114|0.134104101|17.18060709|24.2729073', '194|-2.023606828|20.67326189|0.134008581|17.22865219|24.33475639', '195|-2.015942013|20.73088905|0.133912066|17.27662259|24.39641931', '196|-2.008305745|20.7883851|0.133814954|17.32450423|24.4579009', '197|-2.000706389|20.84574003|0.133717552|17.37228509|24.51920324', '198|-1.993150137|20.90294449|0.1336202|17.41995236|24.58032971', '199|-1.985643741|20.95998909|0.133523244|17.46749315|24.64128395', '200|-1.97819451|21.01686433|0.133427032|17.51489451|24.70206989', '201|-1.970810308|21.07356067|0.133331914|17.56214342|24.76269168', '202|-1.96349954|21.1300685|0.133238245|17.60922679|24.82315378', '203|-1.956271141|21.18637813|0.133146383|17.65613146|24.88346091', '204|-1.949134561|21.24247982|0.13305669|17.70284417|24.94361805', '205|-1.942099744|21.29836376|0.132969531|17.74935161|25.00363048', '206|-1.935177101|21.35402009|0.132885274|17.79564039|25.06350375', '207|-1.92837748|21.40943891|0.132804292|17.84169701|25.1232437', '208|-1.921712136|21.46461026|0.132726962|17.8875079|25.18285645', '209|-1.915192685|21.51952414|0.132653664|17.9330594|25.24234842', '210|-1.908831065|21.57417053|0.132584784|17.97833773|25.30172632', '211|-1.902639482|21.62853937|0.132520711|18.02332903|25.36099716', '212|-1.896630358|21.68262062|0.132461838|18.06801933|25.42016826', '213|-1.890816268|21.73640419|0.132408563|18.11239453|25.47924723', '214|-1.885209876|21.78988003|0.132361289|18.15644042|25.538242', '215|-1.879823505|21.84303819|0.132320427|18.20014256|25.59716095', '216|-1.874670324|21.8958685|0.132286382|18.24348662|25.65601244', '217|-1.869760299|21.94836168|0.1322596|18.28645727|25.71480629', '218|-1.865113245|22.00050569|0.132240418|18.32904183|25.77354888', '219|-1.860734944|22.05229242|0.13222933|18.37122369|25.83225207', '220|-1.85663384|22.10371305|0.132226801|18.41298696|25.89092687', '221|-1.852827186|22.15475603|0.132233201|18.45431794|25.94958116', '222|-1.849323204|22.20541249|0.132248993|18.49520062|26.00822631', '223|-1.846131607|22.255673|0.132274625|18.53561932|26.06687321', '224|-1.843261294|22.30552831|0.132310549|18.57555819|26.1255331', '225|-1.840720248|22.3549693|0.132357221|18.61500111|26.18421759', '226|-1.83851544|22.40398706|0.132415103|18.65393178|26.24293861', '227|-1.83665586|22.45257182|0.132484631|18.69233437|26.30170723', '228|-1.835138046|22.50071778|0.132566359|18.73019025|26.36053932', '229|-1.833972004|22.54841437|0.132660699|18.7674838|26.41944523', '230|-1.833157751|22.59565422|0.132768153|18.80419732|26.47843912', '231|-1.83269562|22.64242956|0.132889211|18.84031318|26.53753478', '232|-1.832584342|22.68873292|0.133024368|18.87581348|26.59674639', '233|-1.832820974|22.73455713|0.133174129|18.91067999|26.65608851', '234|-1.833400825|22.7798953|0.133338999|18.9448942|26.71557609', '235|-1.834317405|22.82474087|0.133519496|18.97843726|26.77522448', '236|-1.83555752|22.86908912|0.133716192|19.0112887|26.83505132', '237|-1.837119466|22.91293151|0.133929525|19.04343134|26.89506944', '238|-1.838987063|22.95626373|0.134160073|19.07484425|26.95529697', '239|-1.841146139|22.99908062|0.134408381|19.10550722|27.01575092', '240|-1.84233016|23.02029424|0.134539365|19.12055111|27.04606818');
		var girls_bmi = new Array('24|-1.024496827|16.38804056|0.085025838|14.3801866|17.97371413', '25|-1.102698353|16.3189719|0.084214052|14.34527262|17.88748812', '26|-1.18396635|16.25207985|0.083455124|14.31096806|17.80489051', '27|-1.268071036|16.18734669|0.082748284|14.27727686|17.72586396', '28|-1.354751525|16.12475448|0.082092737|14.24420303|17.65035137', '29|-1.443689692|16.06428762|0.081487717|14.21174909|17.57829774', '30|-1.53454192|16.00593001|0.080932448|14.17991775|17.50964839', '31|-1.626928093|15.94966631|0.080426175|14.14871111|17.44434994', '32|-1.720434829|15.89548197|0.079968176|14.11813062|17.38235043', '33|-1.814635262|15.84336179|0.079557735|14.08817793|17.32359846', '34|-1.909076262|15.79329146|0.079194187|14.0588539|17.26804436', '35|-2.003296102|15.7452564|0.078876895|14.03015932|17.21563951', '36|-2.096828937|15.69924188|0.078605255|14.00209476|17.16633643', '37|-2.189211877|15.65523282|0.078378696|13.97466073|17.12008872', '38|-2.279991982|15.61321371|0.078196674|13.94785767|17.07685104', '39|-2.368732949|15.57316843|0.078058667|13.92168608|17.03657894', '40|-2.455021314|15.53508019|0.077964169|13.89614655|16.99922885', '41|-2.538471972|15.49893145|0.077912684|13.87123981|16.96475788', '42|-2.618732901|15.46470384|0.077903716|13.84696678|16.93312378', '43|-2.695488973|15.43237817|0.077936763|13.82332865|16.90428477', '44|-2.768464816|15.40193436|0.078011309|13.80032682|16.87819947', '45|-2.837426693|15.37335154|0.078126817|13.77796299|16.85482681', '46|-2.902178205|15.34660842|0.078282739|13.75623885|16.83412628', '47|-2.962580386|15.32168181|0.078478449|13.73515717|16.81605638', '48|-3.018521987|15.29854897|0.078713325|13.71472021|16.80057671', '49|-3.069936555|15.27718618|0.078986694|13.6949307|16.78764654', '50|-3.116795864|15.2575692|0.079297841|13.67579162|16.77722512', '51|-3.159107331|15.23967338|0.079646006|13.65730608|16.76927159', '52|-3.196911083|15.22347371|0.080030389|13.63947739|16.76374505', '53|-3.230276759|15.20894491|0.080450145|13.62230894|16.76060449', '54|-3.259300182|15.19606152|0.080904391|13.60580421|16.75980884', '55|-3.284099963|15.18479799|0.081392203|13.58996673|16.76131695', '56|-3.30481415|15.17512871|0.081912623|13.57480002|16.76508763', '57|-3.321596954|15.16702811|0.082464661|13.56030761|16.77107966', '58|-3.334615646|15.16047068|0.083047295|13.54649295|16.77925184', '59|-3.344047622|15.15543107|0.083659478|13.53335941|16.78956298', '60|-3.35007771|15.15188405|0.084300139|13.52091027|16.80197195', '61|-3.352893805|15.14980479|0.0849682|13.50914853|16.81643792', '62|-3.352691376|15.14916825|0.085662539|13.4980774|16.83291965', '63|-3.34966438|15.14994984|0.086382035|13.48769977|16.85137625', '64|-3.343998803|15.15212585|0.087125591|13.47801782|16.87176785', '65|-3.335889574|15.15567186|0.087892047|13.4690344|16.89405345', '66|-3.325522491|15.16056419|0.088680264|13.46075175|16.91819285', '67|-3.31307846|15.16677947|0.089489106|13.45317191|16.94414613', '68|-3.298732648|15.17429464|0.090317434|13.44629667|16.97187362', '69|-3.282653831|15.18308694|0.091164117|13.44012761|17.00133593', '70|-3.265003896|15.1931339|0.092028028|13.43466608|17.03249399', '71|-3.245937506|15.20441335|0.092908048|13.42991321|17.065309', '72|-3.225606516|15.21690296|0.093803033|13.42587042|17.09974172', '73|-3.204146115|15.2305815|0.094711916|13.42253788|17.13575468', '74|-3.181690237|15.24542745|0.095633595|13.41991629|17.17330968', '75|-3.158363475|15.26141966|0.096566992|13.41800595|17.21236911', '76|-3.134282833|15.27853728|0.097511046|13.41680692|17.25289572', '77|-3.109557879|15.29675967|0.09846471|13.41631905|17.29485256', '78|-3.084290931|15.31606644|0.099426955|13.41654198|17.33820304', '79|-3.058577292|15.33643745|0.100396769|13.41747514|17.38291092', '80|-3.032505499|15.35785274|0.101373159|13.41911775|17.42894029', '81|-3.0061576|15.38029261|0.10235515|13.42146884|17.4762556', '82|-2.979609448|15.40373754|0.103341788|13.42452722|17.52482162', '83|-2.952930993|15.42816819|0.104332139|13.42829152|17.57460349', '84|-2.926186592|15.45356545|0.105325289|13.43276016|17.6255667', '85|-2.899435307|15.47991037|0.106320346|13.43793139|17.67767708', '86|-2.872731211|15.50718419|0.10731644|13.44380325|17.7309008', '87|-2.846123683|15.53536829|0.108312721|13.45037362|17.78520438', '88|-2.819657704|15.56444426|0.109308364|13.45764018|17.8405547', '89|-2.793374145|15.5943938|0.110302563|13.46560044|17.89691898', '90|-2.767310047|15.6251988|0.111294537|13.47425174|17.95426475', '91|-2.741498897|15.65684126|0.112283526|13.48359125|18.01255992', '92|-2.715970894|15.68930333|0.113268793|13.49361598|18.07177271', '93|-2.690753197|15.7225673|0.114249622|13.50432278|18.13187166', '94|-2.665870146|15.75661555|0.115225321|13.51570835|18.19282565', '95|-2.641343436|15.79143062|0.116195218|13.52776922|18.25460388', '96|-2.617192204|15.82699517|0.117158667|13.54050176|18.31717594', '97|-2.593430614|15.86329241|0.118115073|13.55390172|18.38051241', '98|-2.570076037|15.90030484|0.119063807|13.56796556|18.44458291', '99|-2.547141473|15.93801545|0.12000429|13.58268918|18.50935798', '100|-2.524635245|15.97640787|0.120935994|13.59806788|18.57480931', '101|-2.502569666|16.01546483|0.121858355|13.61409768|18.6409074', '102|-2.48095189|16.05516984|0.12277087|13.63077388|18.70762408', '103|-2.459785573|16.09550688|0.123673085|13.6480912|18.77493214', '104|-2.439080117|16.13645881|0.124564484|13.6660455|18.84280276', '105|-2.418838304|16.17800955|0.125444639|13.68463148|18.91120897', '106|-2.399063683|16.22014281|0.126313121|13.70384401|18.98012366', '107|-2.379756861|16.26284277|0.127169545|13.72367745|19.04952063', '108|-2.360920527|16.30609316|0.128013515|13.74412656|19.11937316', '109|-2.342557728|16.34987759|0.128844639|13.7651862|19.18965453', '110|-2.324663326|16.39418118|0.129662637|13.78684956|19.26034062', '111|-2.307240716|16.43898741|0.130467138|13.80911155|19.33140487', '112|-2.290287663|16.48428082|0.131257852|13.83196589|19.4028226', '113|-2.273803847|16.53004554|0.132034479|13.85540667|19.47456869', '114|-2.257782149|16.57626713|0.132796819|13.87942647|19.54662051', '115|-2.242227723|16.62292864|0.133544525|13.90402053|19.6189515', '116|-2.227132805|16.67001572|0.134277436|13.92918106|19.69153965', '117|-2.212495585|16.71751288|0.134995324|13.95490163|19.7643612', '118|-2.19831275|16.76540496|0.135697996|13.98117536|19.83739314', '119|-2.184580762|16.81367689|0.136385276|14.00799522|19.91061278', '120|-2.171295888|16.86231366|0.137057004|14.03535405|19.98399779', '121|-2.158454232|16.91130036|0.137713039|14.06324456|20.05752615', '122|-2.146051754|16.96062216|0.138353254|14.0916593|20.13117619', '123|-2.134084303|17.0102643|0.138977537|14.12059071|20.20492657', '124|-2.122547629|17.06021213|0.139585795|14.15003106|20.27875629', '125|-2.111437411|17.11045106|0.140177947|14.17997251|20.35264468', '126|-2.100749266|17.16096656|0.140753927|14.21040706|20.42657139', '127|-2.090478774|17.21174424|0.141313686|14.2413266|20.50051644', '128|-2.080621484|17.26276973|0.141857186|14.27272286|20.57446015', '129|-2.071172932|17.31402878|0.142384404|14.30458743|20.64838321', '130|-2.062128649|17.3655072|0.142895332|14.33691178|20.72226661', '131|-2.053484173|17.4171909|0.143389972|14.36968723|20.79609169', '132|-2.045235058|17.46906585|0.143868341|14.40290497|20.86984014', '133|-2.03737688|17.52111811|0.144330469|14.43655605|20.94349396', '134|-2.029906684|17.57333347|0.144776372|14.47063181|21.01703489', '135|-2.022817914|17.62569869|0.145206138|14.50512237|21.09044653', '136|-2.016107084|17.67819987|0.145619819|14.54001862|21.16371155', '137|-2.009769905|17.7308234|0.146017491|14.57531107|21.2368133', '138|-2.003802134|17.78355575|0.146399239|14.61099007|21.30973548', '139|-1.998199572|17.83638347|0.146765161|14.64704584|21.38246211', '140|-1.992958064|17.88929321|0.147115364|14.68346846|21.45497756', '141|-1.988073505|17.94227168|0.147449967|14.72024789|21.52726655', '142|-1.983541835|17.9953057|0.147769097|14.75737391|21.5993141', '143|-1.979359041|18.04838216|0.148072891|14.7948362|21.6711056', '144|-1.975521156|18.10148804|0.148361495|14.83262428|21.74262677', '145|-1.972024258|18.15461039|0.148635067|14.87072753|21.81386368', '146|-1.968864465|18.20773639|0.148893769|14.90913518|21.88480271', '147|-1.966037938|18.26085325|0.149137776|14.94783635|21.95543061', '148|-1.963540872|18.31394832|0.14936727|14.98681999|22.02573445', '149|-1.961369499|18.36700902|0.149582439|15.0260749|22.09570166', '150|-1.959520079|18.42002284|0.149783482|15.06558978|22.16531999', '151|-1.9579889|18.47297739|0.149970604|15.10535314|22.23457754', '152|-1.956772271|18.52586035|0.15014402|15.14535337|22.30346276', '153|-1.95586652|18.57865951|0.15030395|15.18557871|22.37196443', '154|-1.955267984|18.63136275|0.150450621|15.22601726|22.44007167', '155|-1.954973011|18.68395801|0.15058427|15.26665697|22.50777397', '156|-1.954977947|18.73643338|0.150705138|15.30748565|22.57506113', '157|-1.955279136|18.788777|0.150813475|15.34849095|22.6419233', '158|-1.955872909|18.84097713|0.150909535|15.38966039|22.70835101', '159|-1.956755579|18.89302212|0.150993582|15.43098133|22.77433508', '160|-1.957923436|18.94490041|0.151065883|15.47244099|22.83986672', '161|-1.959372737|18.99660055|0.151126714|15.51402643|22.90493747', '162|-1.9610997|19.04811118|0.151176355|15.55572457|22.96953922', '163|-1.963100496|19.09942105|0.151215094|15.59752218|23.03366421', '164|-1.96537124|19.15051899|0.151243223|15.63940588|23.09730502', '165|-1.967907983|19.20139397|0.151261042|15.68136213|23.16045458', '166|-1.970706706|19.25203503|0.151268855|15.72337724|23.2231062', '167|-1.973763307|19.30243131|0.151266974|15.76543738|23.28525349', '168|-1.977073595|19.35257209|0.151255713|15.80752854|23.34689045', '169|-1.980633277|19.40244671|0.151235395|15.84963659|23.40801143', '170|-1.984437954|19.45204465|0.151206347|15.89174721|23.46861112', '171|-1.988483106|19.50135548|0.151168902|15.93384595|23.52868458', '172|-1.992764085|19.55036888|0.151123398|15.97591819|23.5882272', '173|-1.997276103|19.59907464|0.15107018|16.01794916|23.64723476', '174|-2.002014224|19.64746266|0.151009595|16.05992392|23.70570337', '175|-2.00697335|19.69552294|0.150942|16.10182739|23.76362952', '176|-2.012148213|19.7432456|0.150867753|16.14364432|23.82101004', '177|-2.017533363|19.79062086|0.150787221|16.1853593|23.87784214', '178|-2.023123159|19.83763907|0.150700774|16.22695676|23.93412338', '179|-2.028911755|19.88429066|0.150608788|16.26842096|23.98985168', '180|-2.034893091|19.9305662|0.150511645|16.30973602|24.04502533', '181|-2.041060881|19.97645636|0.150409731|16.35088587|24.09964299', '182|-2.047408604|20.02195192|0.15030344|16.3918543|24.15370368', '183|-2.05392949|20.06704377|0.150193169|16.43262492|24.20720678', '184|-2.060616513|20.11172291|0.150079322|16.47318119|24.26015204', '185|-2.067462375|20.15598047|0.149962308|16.5135064|24.3125396', '186|-2.074459502|20.19980767|0.14984254|16.55358366|24.36436993', '187|-2.081600029|20.24319586|0.149720441|16.59339594|24.41564391', '188|-2.088875793|20.28613648|0.149596434|16.63292602|24.46636278', '189|-2.096278323|20.32862109|0.149470953|16.67215653|24.51652812', '190|-2.103798828|20.37064138|0.149344433|16.71106993|24.56614194', '191|-2.111428194|20.41218911|0.149217319|16.74964852|24.61520657', '192|-2.119156972|20.45325617|0.14909006|16.78787442|24.66372475', '193|-2.126975375|20.49383457|0.14896311|16.82572959|24.71169957', '194|-2.134873266|20.5339164|0.148836931|16.86319583|24.75913451', '195|-2.142840157|20.57349387|0.148711989|16.90025476|24.80603342', '196|-2.150865204|20.61255929|0.148588757|16.93688787|24.85240053', '197|-2.158937201|20.65110506|0.148467715|16.97307644|24.89824041', '198|-2.167044578|20.6891237|0.148349348|17.00880162|24.94355805', '199|-2.175176987|20.72660728|0.14823412|17.04404492|24.98835785', '200|-2.183317362|20.76355011|0.148122614|17.07878553|25.03264836', '201|-2.191457792|20.79994337|0.148015249|17.11300574|25.07643282', '202|-2.199583649|20.83578051|0.147912564|17.14668547|25.11971866', '203|-2.207681525|20.87105449|0.147815078|17.17980508|25.16251271', '204|-2.215737645|20.90575839|0.147723315|17.21234472|25.20482218', '205|-2.223739902|20.93988477|0.147637768|17.24428517|25.24665348', '206|-2.231667995|20.97342858|0.147559083|17.27560407|25.28801794', '207|-2.239511942|21.00638171|0.147487716|17.30628297|25.32892108', '208|-2.247257081|21.0387374|0.14742421|17.33630159|25.3693713', '209|-2.254885145|21.07048996|0.147369174|17.36563825|25.40937929', '210|-2.26238209|21.10163241|0.147323144|17.39427286|25.44895346', '211|-2.269731517|21.13215845|0.147286698|17.42218439|25.48810377', '212|-2.276917229|21.16206171|0.147260415|17.44935184|25.52684029', '213|-2.283925442|21.1913351|0.147244828|17.47575509|25.56517184', '214|-2.290731442|21.21997472|0.147240683|17.50136974|25.603114', '215|-2.29732427|21.24797262|0.147248467|17.52617667|25.64067435', '216|-2.303687802|21.27532239|0.14726877|17.55015468|25.67786376', '217|-2.309799971|21.30201933|0.147302299|17.57328018|25.714697', '218|-2.315651874|21.32805489|0.147349514|17.59553468|25.75118107', '219|-2.32121731|21.35342563|0.147411215|17.61689275|25.7873338', '220|-2.326481911|21.37812462|0.147487979|17.63733356|25.82316611', '221|-2.331428139|21.40214589|0.147580453|17.6568349|25.85869115', '222|-2.336038473|21.42548351|0.147689289|17.67537444|25.89392241', '223|-2.34029545|21.44813156|0.14781515|17.69292976|25.92887369', '224|-2.344181703|21.47008412|0.147958706|17.70947829|25.96355908', '225|-2.34768|21.49133529|0.148120633|17.72499741|25.99799301', '226|-2.350773286|21.51187918|0.148301619|17.73946435|26.03219019', '227|-2.353444725|21.53170989|0.148502355|17.75285625|26.06616563', '228|-2.355677743|21.55082155|0.148723546|17.76515018|26.09993465', '229|-2.35745607|21.56920824|0.148965902|17.77632308|26.13351285', '230|-2.358763788|21.58686406|0.149230142|17.78635182|26.16691611', '231|-2.359585369|21.60378309|0.149516994|17.79521318|26.20016061', '232|-2.359905726|21.61995939|0.149827195|17.80288385|26.23326279', '233|-2.359710258|21.635387|0.150161492|17.80934044|26.26623937', '234|-2.358980464|21.65006126|0.150520734|17.81455755|26.29911039', '235|-2.357714508|21.6639727|0.150905439|17.81851675|26.33188509', '236|-2.355892424|21.67711736|0.151316531|17.82119134|26.36458581', '237|-2.353501353|21.68948935|0.151754808|17.82255737|26.39723077', '238|-2.350528726|21.70108288|0.152221086|17.8225906|26.42983873', '239|-2.346962247|21.71189225|0.152716206|17.82126653|26.4624291', '240|-2.34495843|21.71699934|0.152974718|17.82009046|26.47871966');

		this.boys_data = {};
		this.girls_data = {};

		// Convert those data string arrays into something meaningful
		for (var i = 0; i < boys_bmi.length; i++) {
			var arr = boys_bmi[i].split('|')
			for (var j = 0; j < arr.length; j++) {
				arr[j] = parseFloat(arr[j]);
			}
			this.boys_data[arr[0]] = arr;
		};

		for (var i = 0; i < girls_bmi.length; i++) {
			var arr = girls_bmi[i].split('|');
			for (var j = 0; j < arr.length; j++) {
				arr[j] = parseFloat(arr[j]);
			}
			this.girls_data[arr[0]] = arr;
		};

	}
	this.setup();

	// Calculates the percentile position of the provided gender (bool), age (int in years), and bmi in decimal form.
	this.calculate = function(isMale, age, bmi) {
		if(age < 2) {
			age = 2;
		}
		if(age > 23) {
			age = 23;
		}

		var percentiles_array;
		isMale ? percentiles_array = this.boys_data : percentiles_array = this.girls_data;
		var key = (Math.round(age)*12)
		, L = 0
		, M = 0
		, S = 0
		, P = 0
		, Z = 0;

		L = percentiles_array[key][1];
		M = percentiles_array[key][2];
		S = percentiles_array[key][3];

		if((!isNaN(M)) && (!isNaN(S))) {
			if(L == 0) {
				Z = Math.log(bmi/M)/S;
			} else {
				Z = (Math.pow((bmi/M), L)-1)/(L*S);
			}

			P=1-1/Math.sqrt(2*3.14159265)*Math.exp(-Math.pow(Math.abs(Z),2)/2)*(0.4361836*(1/(1+0.33267*Math.abs(Z)))-0.1201676*Math.pow((1/(1+0.33267*Math.abs(Z))),2)+0.937298*Math.pow((1/(1+0.33267*Math.abs(Z))),3));

			var centile = 0;
			if(Z>0) {
				centile = (P*100);
			} else {
				centile = (100-(P*100));
			}

			centile = Math.round(centile);

			return centile;
		} else {
			return -1; // error val
		}

	};

	// Takes a BMI Classification and returns the proper response text
	this.getBMIClassificationResponseText = function(percentile) {
		var classification = this.getBMIClassification(percentile);
		if(classification == "U") {
			return "subpondere<br><br><center><i class='fa fa-frown-o' style='color:#444445;font-size:100px;'></i></center>";
		} else if(classification == "N") {
			return "<b style='color:green'>o greutate normală</b><br><br><center><i class='fa fa-smile-o' style='color:#6BB64D;font-size:100px;'></i></center>";
		} else if(classification == "R") {
			return "<b style='color:orange'>suprapondere</b><br><br><center><i class='fa fa-meh-o' style='color:#F1984A;font-size:100px;'></i></center>";
		} else if(classification == "O") {
			return "<b style='color:red'>obezitate</b><br><br><center><i class='fa fa-frown-o' style='color:#DF0000;font-size:100px;'></i></center>";
		}
	};

	// Takes a BMI percentile and returns a BMI classification character
	this.getBMIClassification = function(percent) {
		if(percent > 95) {
			return "O"; // Obese
		} else if(percent > 85) {
			return "R"; // Overweight
		} else if(percent < 0) {
			return "ERR"; // Error
		} else if(percent < 5) {
			return "U"; // Underweight
		} else { // Normal weight
			return "N";
		}
	};

	// Takes a BMI decimal and returns BMI classification
	this.getBMIStatus = function(bmi) {
		if(bmi < 16) {
			return "subpondere severă";
		} else if(bmi < 18.5) {
			return "subpondere";
		} else if(bmi < 25) {
			return "o greutate normală";
		} else if(bmi < 30) {
			return "suprapondere";
		} else if((bmi > 30) && (bmi < 35)) {
			return "obezitate";
		} else {
			return "obezitate morbidă";
		}
	};

};

/****************
 * BMI Calculator
 ***************/
// Extends the Date function to return month strings.
Date.prototype.getStringMonth = function() {
	var m = this.getMonth()+1;
	if(m == 1) {
		return "January";
	} else if(m == 2) {
		return "February";
	} else if(m == 3) {
		return "March";
	} else if(m == 4) {
		return "April";
	} else if(m == 5) {
		return "May";
	} else if(m == 6) {
		return "June";
	} else if(m == 7) {
		return "July";
	} else if(m == 8) {
		return "August";
	} else if(m == 9) {
		return "September";
	} else if(m == 10) {
		return "October";
	} else if(m == 11) {
		return "November";
	} else if(m == 12) {
		return "December";
	} else {
		return "Invalid Month."
	}
};

var BMICalculator = function() {
	// Load the Percentile computation function
	if(typeof Percentile != "undefined") {
		percentileHelper = new Percentile();
	} else {
		alert("Could not find Percentile class. BMI Calculator will not function without");
	}

	var MS_IN_A_DAY = 86400000; // Constant for how many milliseconds are in a day
	// Takes two Date objects set to birthday and current date, returns age in decimal form.
	this.computeAge = function(birth_date, current_date) {
		var ageDiff = current_date - birth_date;
		return (ageDiff / MS_IN_A_DAY)/365;
	};

	/**
	 * getDateTimeObject(string)
	 *
	 * Takes a string in the form of YYYY/MM and returns the date
	 */
	this.getDateTimeObject = function(string) {
		var strArr = string.split("/")
		if(strArr.length != 2) {
			return false;
		} else {
			return new Date(strArr[0], strArr[1]-1, 1, 0, 0, 0);
		}
	};

	/**
	 * calculateBMIWeightRange(data_point)
	 *
	 * Calcualtes the weight range of a specific data point and returns an object with a lo_weight_rand
	 * and a hi_weight_range
	 */
	this.calculateBMIWeightRange = function(data_point) {
		if(isMale) {
			var percentiles_array = percentileHelper.boys_data;
		} else {
			var percentiles_array = percentileHelper.girls_data;
		}

		var low_bmi = 0
		, high_bmi = 0
		, key = (Math.round(data_point.age)*12);

		if(!isNaN(percentiles_array[key][4]))
			low_bmi = percentiles_array[key][4];

		if(!isNaN(percentiles_array[key][5]))
			high_bmi = percentiles_array[key][5];

		var ret = {};

		if((low_bmi > 0) && (high_bmi > 0)) {
			if(tableUnits == "inches") {
				ret.lo_weight_range = that.calculateStandardBMIWeight(isMale, data_point, low_bmi);
				ret.hi_weight_range = that.calculateStandardBMIWeight(isMale, data_point, high_bmi);
			} else {
				ret.lo_weight_range = that.calculateMetricBMIWeight(isMale, data_point, low_bmi);
				ret.hi_weight_range = that.calculateMetricBMIWeight(isMale, data_point, high_bmi);
			}
		}
		return ret;
	};

	/**
	 * calculateStandardBMIWeight(isMale, data_point, bmi)
	 *
	 * Calculates the appropriate weight for a height and bmi
	 */
	this.calculateStandardBMIWeight = function(isMale, data_point, bmi) {
		var inches = data_point.height
		return Math.round(((inches * inches) * bmi) / 703);
	};

	/**
	 * calculateMetricBMIWeight(isMale, data_point, bmi
	 *
	 * Calculates the appropriate metric weight for a height and bmi
	 */
	this.calculateMetricBMIWeight = function(isMale, data_point, bmi) {
		var cm = data_point.height;
		return Math.round(bmi * (cm * cm / 1000)) / 10;
	};

	/**
	 * calculateTableBMI()
	 *
	 * Return array of BMI's based on the data in the table
	 */
	this.calculateTableBMI = function() {
		that.dataPoints = [];
		var entries = this.tableBody.children;
		for (var i = 0; i < entries.length; i++) {
			var entry = entries[i].children
			, date   = that.getDateTimeObject(entry[0].children[1].options[entry[0].children[1].selectedIndex].value + "/" + entry[0].children[0].options[entry[0].children[0].selectedIndex].value)
			, height = entry[1].children[0].value
			, weight = entry[2].children[0].value
			, bmi = that.calculateBMI(height, weight);

			if(date && height && weight && bmi) {
				var point = {};
				point.index = i;
				point.date = date;
				point.height = height;
				point.weight = weight;
				point.bmi = bmi;
				point.age = that.computeAge(that.birthDate, date);
				point.percentile = percentileHelper.calculate(isMale, point.age, point.bmi);
				that.dataPoints.push(point);
			}
		}

		if(point) {
			that.updateHorizontalGraph(point);
			that.updateResultsString(point);
		}
		that.lineGraphDraw();
	};

	/**
	 * calculateBMI(height, weight)
	 *
	 * Calculates a given BMI based off the current table unit setting
	 */
	this.calculateBMI = function(height, weight) {
		if(tableUnits == 'inches') {
		// Calculate BMI for US units of measurement
			var ret = Math.round((weight * 703 * 10) / (height * height)) / 10;
			return ret;
		} else {
		// Calculate BMI for Metric measurements
			var ret = Math.round((weight / (height * height)) * 100000) / 10
			return ret;
		}
	};

	/**
	 * buildResultsHTML(data_point)
	 *
	 * Build the HTML for insertion into the DOM upon calculating a BMI
	 */
	this.buildResultsHTML = function(data_point) {
		var str = "Your BMI is <strong>";
		str = str + data_point.bmi.toPrecision(3) + ".</strong>";

		str = str + " That puts you <strong>";
		if(data_point.percentile < 5) {
			str = str + "below the 5th";
		} else if(data_point.percentile > 95) {
			str = str + "above the 95th";
		} else {
			str = str + "in the " + data_point.percentile;
		}

		str = str + " percentile</strong>, which indicates you are "

		var classification = percentileHelper.getBMIClassification(data_point.percentile);

		if(classification == "U") {
			var status = "subpondere";
		} else if( classification == "N") {
			var status = "o greutate normală";
		} else if(classification == "R") {
			var status = "suprapondere";
		} else if(classification == "O") {
			var status = "obezitate";
		} else {
			var status = "";
		}


		str = str + "<strong>" + status + ".</strong>";
		str = str + " The healthy weight range for your height and age is ";

		var wRange = this.calculateBMIWeightRange(data_point)
		, wRangeStr = wRange.lo_weight_range + " to " + wRange.hi_weight_range;

		if(tableUnits == "inches") {
			wRangeStr = wRangeStr + " lbs.";
		} else {
			wRangeStr = wRangeStr + " kgs.";
		}

		str = str + "<strong>" + wRangeStr + "</strong>";
		return str;
	};

	// Private variables for Results Text
	var resultsTextHolder = document.getElementById('kh-bmicalc-graph-bar-results');

	var resultsTextBMI = document.getElementById('kh-bmicalc-results-text-bmi')
	, resultsTextDateMonth = document.getElementById('kh-bmicalc-results-date-month')
	, resultsTextDateYear  = document.getElementById('kh-bmicalc-results-date-year')
	, resultsTextHolder = document.getElementById('kh-bmicalc-graph-bar-results')

	/**
	 * updateResultsString(point)
	 *
	 * Takes a data point object and it updates the results text on the graph
	 */
	this.updateResultsString = function(point) {
		var html = this.buildResultsHTML(point);
		resultsTextHolder.innerHTML = html;
	}

	// Private bar graph variables
	var currentBarMarkerPercent = 55
	, barMarker = document.getElementById('kh-bmicalc-graph-bar-marker')
	, barMarkerTextPercent = document.getElementById('kh-bmicalc-graph-bar-text-percent')
	, barMarkerTextStatus = document.getElementById('kh-bmicalc-graph-bar-text-status')
	, barMarkerContainer = document.getElementById('kh-bmicalc-graph-bar-container')
	, barMarkerContainerEmpty = document.getElementById('kh-bmicalc-graph-bar-container-empty')
	, barImage = document.getElementById('kh-bmicalc-graph-top')

	/**
	 * updateHorizontalGraph(point)
	 *
	 * Takes a data point from this.dataPoints and updates the horizontal scale.
	 */
	this.updateHorizontalGraph = function(point) {

		barMarker.setAttribute('class', '');

		var tempMonth = parseInt(point.date.getMonth() + 1);

		if(tempMonth < 10) {
			tempMonth = "0" + tempMonth;
		}

		resultsTextDateMonth.innerHTML = tempMonth;
		resultsTextDateYear.innerHTML = point.date.getFullYear();

		var classification = percentileHelper.getBMIClassification(point.percentile)
		, percNum = percentileHelper.calculate(isMale, point.age, point.bmi);

		if(classification == "U") {
			var status = "subpondere";
		} else if( classification == "N") {
			var status = "o greutate normală";
		} else if(classification == "R") {
			var status = "suprapondere";
		} else if(classification == "O") {
			var status = "obezitate";
		} else {
			var status = "";
		}

		// If the percentage is above the 95th percentile, just show "> 95%"
		if(percNum > 95) {
			percNum = 95;
			barMarkerTextPercent.innerHTML = "> 95 %";
		// If the percentage is below the 5th percentile, just show "< 5%"
		} else if(percNum < 5) {
			percNum = 5;
			barMarkerTextPercent.innerHTML = "< 5 %";
		// Otherwise display the percentage as calculated
		} else {
			barMarkerTextPercent.innerHTML = percNum + "%";
		}

		barMarkerTextStatus.innerHTML = "(" + status + ")";

		this.barGraphPositionMarker(percNum);

		if(percNum == -1) {
			barMarker.setAttribute('class', 'kh-bmicalc-hide');
		}
	}

	/**
	 * barGraphPositionMarker(percent)
	 *
	 * Takes in a percent and postion the marker on the bar graph accordingly
	 */
	this.barGraphPositionMarker = function(percent) {
		if(percent >= 0 && percent <= 100) {
			currentBarMarkerPercent = percent; // Update the percent so we can keep track on resize
			barMarker.style.left = ((barImage.offsetWidth*percent)/100)-(barMarker.offsetWidth/2) + "px";
		}
	};

	/**
	 * genderToggled(event)
	 *
	 * Called when gender radio buttons are toggled
	 */
	function genderToggled(event) {
		that.showGraphResults();
		showGraphs = true;
		isMale = false;
		if(event.currentTarget.id == "kh-bmicalc-radio-sex-male") isMale = true;

		// Recalculate the results based on the new gender toggled
		that.calculateTableBMI();
		that.showGraphResults();
	};

	/**
	 * getCurrentBirthDateString()
	 *
	 * Returns the current birth date in string format: "MM/YYYY"
	 */
	this.getCurrentBirthDateString = function() {
		return that.selectBirthYear.value + "/" + that.selectBirthMonth.value;
	};

	/**
	 * getCurrentBirthDate()
	 *
	 * Returns a date time object of the current birth date
	 */
	this.getCurrentBirthDate = function() {
		return that.getDateTimeObject(that.getCurrentBirthDateString());
	};
};

function calculateBMIWeightRange(data_point) {
	if(isMale) {
		var percentiles_array = percentileHelper.male_data;
	} else {
		var percentiles_array = percentileHelper.female_data;
	}

	var low_bmi = 0
	, high_bmi = 0
	, key = (Math.round(data_point.age)*12);

	if(!isNaN(percentiles_array[key][4]))
		low_bmi = percentiles_array[key][4];

	if(!isNaN(percentiles_array[key][5]))
		high_bmi = percentiles_array[key][5];

	var ret = {};

	if((low_bmi > 0) && (high_bmi > 0)) {
		if(tableUnits == "inches") {
			ret.lo_weight_range = that.calculateStandardBMIWeight(isMale, data_point, low_bmi);
			ret.hi_weight_range = that.calculateStandardBMIWeight(isMale, data_point, high_bmi);
		} else {
			ret.lo_weight_range = that.calculateMetricBMIWeight(isMale, data_point, low_bmi);
			ret.hi_weight_range = that.calculateMetricBMIWeight(isMale, data_point, high_bmi);
		}
	}

	return ret;
}

function calculate(isMale, age, bmi) {
	if(age < 2) {
		age = 2;
	}

	if(age > 23) {
		age = 23;
	}

	var percentiles_array;
	isMale ? percentiles_array = this.boys_data : percentiles_array = this.girls_data;
	var key = (Math.round(age)*12)
	, L = 0
	, M = 0
	, S = 0
	, P = 0
	, Z = 0;

	L = percentiles_array[key][1];
	M = percentiles_array[key][2];
	S = percentiles_array[key][3];

	if((!isNaN(M)) && (!isNaN(S))) {
		if(L == 0) {
			Z = Math.log(bmi/M)/S;
		} else {
			Z = (Math.pow((bmi/M), L)-1)/(L*S);
		}

		P = 1-1/Math.sqrt(2*3.14159265)*Math.exp(-Math.pow(Math.abs(Z),2)/2)*(0.4361836*(1/(1+0.33267*Math.abs(Z)))-0.1201676*Math.pow((1/(1+0.33267*Math.abs(Z))),2)+0.937298*Math.pow((1/(1+0.33267*Math.abs(Z))),3));

		var centile = 0;

		if(Z > 0) {
			centile = (P*100);
		} else {
			centile = (100-(P*100));
		}

		centile = Math.round(centile);

		return centile;
	} else {
		return -1; // error val
	}
}

function genderData() {
	var male_bmi = new Array('24|-1.982373595|16.54777487|0.080127429|14.71929257|18.11954923', '25|-1.924100169|16.49442763|0.079233994|14.68360841|18.03668013', '26|-1.86549793|16.44259552|0.078389356|14.64843329|17.95700228', '27|-1.807261899|16.3922434|0.077593501|14.61378626|17.88047101', '28|-1.750118905|16.34333654|0.076846462|14.57968578|17.80704259', '29|-1.69481584|16.29584097|0.076148308|14.54614966|17.73667414', '30|-1.642106779|16.24972371|0.075499126|14.51319492|17.66932346', '31|-1.592744414|16.20495268|0.074898994|14.48083795|17.6049486', '32|-1.547442391|16.16149871|0.074347997|14.44909329|17.54350898', '33|-1.506902601|16.11933258|0.073846139|14.41797561|17.48496295', '34|-1.471770047|16.07842758|0.07339337|14.38749811|17.42926933', '35|-1.442628957|16.03875896|0.072989551|14.35767293|17.37638677', '36|-1.419991255|16.00030401|0.072634432|14.32851119|17.32627356', '37|-1.404277619|15.96304277|0.072327649|14.30002256|17.27888795', '38|-1.39586317|15.92695418|0.07206864|14.27221761|17.23418554', '39|-1.394935252|15.89202582|0.071856805|14.24510202|17.19212545', '40|-1.401671596|15.85824093|0.071691278|14.21868433|17.15266201', '41|-1.416100312|15.82558822|0.071571093|14.19297011|17.11575098', '42|-1.438164899|15.79405728|0.071495113|14.16796472|17.08134677', '43|-1.467669032|15.76364255|0.071462106|14.14367089|17.04940504', '44|-1.504376347|15.73433668|0.071470646|14.12009269|17.0198786', '45|-1.547942838|15.70613566|0.071519218|14.09723246|16.99272087', '46|-1.597896397|15.67904062|0.071606277|14.07508966|16.96788739', '47|-1.653732283|15.65305192|0.071730167|14.05366443|16.94533215', '48|-1.714869347|15.62817269|0.071889214|14.03295533|16.92501028', '49|-1.780673181|15.604408|0.072081737|14.01295984|16.90687779', '50|-1.850468473|15.58176458|0.072306081|13.99367445|16.89089179', '51|-1.923551865|15.56025067|0.072560637|13.97509464|16.87701073', '52|-1.999220429|15.5398746|0.07284384|13.95721572|16.86519374', '53|-2.076707178|15.52064993|0.073154324|13.94002947|16.85540483', '54|-2.155348017|15.50258427|0.073490667|13.92353116|16.8476049', '55|-2.234438552|15.48568973|0.073851672|13.90771281|16.84175987', '56|-2.313321723|15.46997718|0.074236235|13.89256678|16.8378366', '57|-2.391381273|15.45545692|0.074643374|13.87808525|16.83580365', '58|-2.468032491|15.44213961|0.075072264|13.86425959|16.83563223', '59|-2.542781541|15.43003207|0.075522104|13.85108308|16.83729272', '60|-2.61516595|15.41914163|0.07599225|13.83854804|16.84075838', '61|-2.684789516|15.40947356|0.076482128|13.82664746|16.84600319', '62|-2.751316949|15.40103139|0.076991232|13.81537489|16.85300198', '63|-2.81445945|15.39381785|0.077519149|13.8047237|16.86173124', '64|-2.87402476|15.38783094|0.07806539|13.79469004|16.87216519', '65|-2.92984048|15.38306945|0.078629592|13.78526882|16.88428085', '66|-2.981796828|15.37952958|0.079211369|13.77645627|16.89805459', '67|-3.029831343|15.37720582|0.079810334|13.76824936|16.91346275', '68|-3.073924224|15.37609107|0.080426086|13.76064574|16.93048153', '69|-3.114093476|15.37617677|0.081058206|13.75364373|16.94908693', '70|-3.15039004|15.37745304|0.081706249|13.7472423|16.96925461', '71|-3.182893018|15.37990886|0.082369741|13.74144099|16.99095993', '72|-3.21170511|15.38353217|0.083048178|13.73623987|17.01417786', '73|-3.23694834|15.38831005|0.083741021|13.73163946|17.03888299', '74|-3.25876011|15.39422883|0.0844477|13.72764072|17.06504953', '75|-3.277281546|15.40127496|0.085167651|13.72424433|17.09265223', '76|-3.292683774|15.40943252|0.085900184|13.72145289|17.12166319', '77|-3.305124073|15.41868691|0.086644667|13.71926775|17.15205629', '78|-3.314768951|15.42902273|0.087400421|13.71769094|17.18380454', '79|-3.321785992|15.44042439|0.088166744|13.71672458|17.21688072', '80|-3.326345795|15.45287581|0.088942897|13.71637124|17.25125697', '81|-3.328602731|15.46636218|0.089728202|13.71663233|17.28690708', '82|-3.328725277|15.48086704|0.090521875|13.71751078|17.32380254', '83|-3.32687018|15.49637465|0.091323162|13.71900887|17.3619157', '84|-3.323188896|15.51286936|0.092131305|13.72112886|17.40121891', '85|-3.317827016|15.53033563|0.092945544|13.72387293|17.44168456', '86|-3.310923871|15.54875807|0.093765118|13.72724315|17.48328513', '87|-3.302612272|15.56812143|0.09458927|13.7312415|17.52599317', '88|-3.293018361|15.58841065|0.095417247|13.73586983|17.56978138', '89|-3.282260813|15.60961101|0.096248301|13.7411299|17.61462266', '90|-3.270454609|15.63170735|0.097081694|13.74702309|17.66048985', '91|-3.257703616|15.65468563|0.097916698|13.753551|17.70735632', '92|-3.244108214|15.67853139|0.098752593|13.7607148|17.75519541', '93|-3.229761713|15.70323052|0.099588675|13.76851558|17.80398077', '94|-3.214751287|15.72876911|0.100424251|13.77695423|17.85368626', '95|-3.199158184|15.75513347|0.101258643|13.78603145|17.90428602', '96|-3.18305795|15.78231007|0.102091189|13.79574779|17.95575444', '97|-3.166520664|15.8102856|0.102921245|13.80610355|18.00806622', '98|-3.1496103|15.83904708|0.103748189|13.81709878|18.06119653', '99|-3.132389637|15.86858123|0.104571386|13.82873375|18.1151201', '100|-3.114911153|15.89887562|0.105390269|13.84100784|18.16981303', '101|-3.097226399|15.92991765|0.106204258|13.85392068|18.22525119', '102|-3.079383079|15.96169481|0.107012788|13.86747174|18.28141055', '103|-3.061423765|15.99419489|0.107815327|13.88166013|18.33826774', '104|-3.043386071|16.02740607|0.108611374|13.89648454|18.39579999', '105|-3.025310003|16.0613159|0.109400388|13.91194439|18.45398355', '106|-3.007225737|16.09591292|0.110181915|13.92803786|18.51279647', '107|-2.989164598|16.13118532|0.110955478|13.94476358|18.57221621', '108|-2.971148225|16.16712234|0.111720691|13.9621189|18.63222223', '109|-2.953208047|16.20371168|0.112477059|13.98010297|18.69279128', '110|-2.935363951|16.24094239|0.1132242|13.99871328|18.75390266', '111|-2.917635157|16.27880346|0.113961734|14.01794738|18.81553565', '112|-2.900039803|16.31728385|0.114689291|14.03780282|18.87766958', '113|-2.882593796|16.35637267|0.115406523|14.0582769|18.94028419', '114|-2.865311266|16.39605916|0.116113097|14.07936677|19.00335954', '115|-2.848204697|16.43633265|0.116808702|14.10106937|19.06687603', '116|-2.831285052|16.47718256|0.117493042|14.1233815|19.13081436', '117|-2.81456189|16.51859843|0.11816584|14.14629977|19.19515554', '118|-2.79804347|16.56056987|0.118826835|14.16982063|19.25988094', '119|-2.781736856|16.60308661|0.119475785|14.19394037|19.3249722', '120|-2.765648008|16.64613844|0.120112464|14.21865508|19.3904113', '121|-2.749782197|16.68971518|0.120736656|14.24396081|19.45618042', '122|-2.734142443|16.73380695|0.121348181|14.26985313|19.52226247', '123|-2.718732873|16.77840363|0.121946849|14.29632789|19.58864006', '124|-2.703555506|16.82349538|0.122532501|14.32338048|19.65529649', '125|-2.688611957|16.86907238|0.123104991|14.35100623|19.72221531', '126|-2.673903164|16.91512487|0.123664186|14.37920031|19.78938034', '127|-2.659429443|16.96164317|0.124209969|14.40795771|19.85677572', '128|-2.645190534|17.00861766|0.124742239|14.43727329|19.92438591', '129|-2.631185649|17.05603879|0.125260905|14.46714175|19.99219565', '130|-2.617413511|17.10389705|0.125765895|14.49755765|20.06019002', '131|-2.603872392|17.15218302|0.126257147|14.52851537|20.12835437', '132|-2.590560148|17.20088732|0.126734613|14.56000917|20.19667437', '133|-2.577474253|17.25000062|0.12719826|14.59203313|20.265136', '134|-2.564611831|17.29951367|0.127648067|14.62458122|20.33372554', '135|-2.551969684|17.34941726|0.128084023|14.65764722|20.40242956', '136|-2.539539972|17.39970308|0.128506192|14.69122381|20.4712365', '137|-2.527325681|17.45036072|0.128914497|14.72530601|20.54013114', '138|-2.515320235|17.50138161|0.129309001|14.75988661|20.60910189', '139|-2.503519447|17.55275674|0.129689741|14.79495883|20.6781365', '140|-2.491918934|17.60447714|0.130056765|14.83051578|20.74722303', '141|-2.480514136|17.6565339|0.130410133|14.86655039|20.81634983', '142|-2.469300331|17.70891811|0.130749913|14.90305549|20.88550554', '143|-2.458272656|17.76162094|0.131076187|14.94002374|20.95467909', '144|-2.447426113|17.81463359|0.131389042|14.97744768|21.02385969', '145|-2.436755595|17.86794729|0.131688579|15.01531973|21.09303687', '146|-2.426255887|17.92155332|0.131974905|15.05363215|21.1622004', '147|-2.415921689|17.97544299|0.132248138|15.09237707|21.23134038', '148|-2.405747619|18.02960765|0.132508403|15.13154651|21.30044717', '149|-2.395728233|18.08403868|0.132755834|15.17113234|21.36951141', '150|-2.385858029|18.1387275|0.132990575|15.2111263|21.43852405', '151|-2.376131459|18.19366555|0.133212776|15.25152001|21.5074763', '152|-2.366542942|18.24884431|0.133422595|15.29230496|21.57635964', '153|-2.357086871|18.3042553|0.133620197|15.33347251|21.64516586', '154|-2.347757625|18.35989003|0.133805756|15.37501389|21.71388701', '155|-2.338549576|18.41574009|0.133979452|15.41692023|21.78251541', '156|-2.3294571|18.47179706|0.13414147|15.4591825|21.85104367', '157|-2.320474586|18.52805255|0.134292005|15.50179159|21.91946467', '158|-2.311596446|18.5844982|0.134431256|15.54473823|21.98777156', '159|-2.302817124|18.64112567|0.134559427|15.58801305|22.05595776', '160|-2.294131107|18.69792663|0.134676731|15.63160658|22.12401698', '161|-2.285532933|18.75489278|0.134783385|15.67550919|22.19194317', '162|-2.277017201|18.81201584|0.134879611|15.71971118|22.25973057', '163|-2.268578584|18.86928753|0.134965637|15.7642027|22.32737368', '164|-2.260211837|18.92669959|0.135041695|15.80897382|22.39486727', '165|-2.251911809|18.98424378|0.135108024|15.85401448|22.46220636', '166|-2.243673453|19.04191185|0.135164867|15.89931451|22.52938625', '167|-2.235491842|19.09969557|0.135212469|15.94486363|22.5964025', '168|-2.227362173|19.15758672|0.135251083|15.99065148|22.66325092', '169|-2.21927979|19.21557707|0.135280963|16.03666757|22.7299276', '170|-2.211240187|19.27365839|0.135302371|16.0829013|22.79642886', '171|-2.203239029|19.33182247|0.135315568|16.129342|22.86275131', '172|-2.195272161|19.39006106|0.135320824|16.17597888|22.92889179', '173|-2.187335625|19.44836594|0.135318407|16.22280106|22.99484741', '174|-2.179425674|19.50672885|0.135308594|16.26979755|23.06061552', '175|-2.171538789|19.56514153|0.135291662|16.31695728|23.12619375', '176|-2.163671689|19.62359571|0.135267891|16.3642691|23.19157996', '177|-2.155821357|19.6820831|0.135237567|16.41172173|23.25677226', '178|-2.147985046|19.74059538|0.135200976|16.45930384|23.32176902', '179|-2.140160305|19.7991242|0.135158409|16.50700399|23.38656886', '180|-2.132344989|19.85766121|0.135110159|16.55481067|23.45117065', '181|-2.124537282|19.916198|0.135056522|16.60271228|23.5155735', '182|-2.116735712|19.97472615|0.134997797|16.65069714|23.57977678', '183|-2.108939167|20.03323719|0.134934285|16.69875348|23.6437801', '184|-2.10114692|20.09172262|0.134866291|16.74686947|23.70758332', '185|-2.093358637|20.15017387|0.134794121|16.79503318|23.77118654', '186|-2.085574403|20.20858236|0.134718085|16.84323264|23.83459013', '187|-2.077794735|20.26693944|0.134638494|16.89145577|23.89779468', '188|-2.070020599|20.32523642|0.134555663|16.93969043|23.96080104', '189|-2.062253431|20.38346455|0.13446991|16.98792443|24.02361032', '190|-2.054495145|20.44161501|0.134381553|17.03614547|24.08622386', '191|-2.046748156|20.49967894|0.134290916|17.08434122|24.14864327', '192|-2.039015385|20.5576474|0.134198323|17.13249925|24.21087038', '193|-2.031300282|20.6155114|0.134104101|17.18060709|24.2729073', '194|-2.023606828|20.67326189|0.134008581|17.22865219|24.33475639', '195|-2.015942013|20.73088905|0.133912066|17.27662259|24.39641931', '196|-2.008305745|20.7883851|0.133814954|17.32450423|24.4579009', '197|-2.000706389|20.84574003|0.133717552|17.37228509|24.51920324', '198|-1.993150137|20.90294449|0.1336202|17.41995236|24.58032971', '199|-1.985643741|20.95998909|0.133523244|17.46749315|24.64128395', '200|-1.97819451|21.01686433|0.133427032|17.51489451|24.70206989', '201|-1.970810308|21.07356067|0.133331914|17.56214342|24.76269168', '202|-1.96349954|21.1300685|0.133238245|17.60922679|24.82315378', '203|-1.956271141|21.18637813|0.133146383|17.65613146|24.88346091', '204|-1.949134561|21.24247982|0.13305669|17.70284417|24.94361805', '205|-1.942099744|21.29836376|0.132969531|17.74935161|25.00363048', '206|-1.935177101|21.35402009|0.132885274|17.79564039|25.06350375', '207|-1.92837748|21.40943891|0.132804292|17.84169701|25.1232437', '208|-1.921712136|21.46461026|0.132726962|17.8875079|25.18285645', '209|-1.915192685|21.51952414|0.132653664|17.9330594|25.24234842', '210|-1.908831065|21.57417053|0.132584784|17.97833773|25.30172632', '211|-1.902639482|21.62853937|0.132520711|18.02332903|25.36099716', '212|-1.896630358|21.68262062|0.132461838|18.06801933|25.42016826', '213|-1.890816268|21.73640419|0.132408563|18.11239453|25.47924723', '214|-1.885209876|21.78988003|0.132361289|18.15644042|25.538242', '215|-1.879823505|21.84303819|0.132320427|18.20014256|25.59716095', '216|-1.874670324|21.8958685|0.132286382|18.24348662|25.65601244', '217|-1.869760299|21.94836168|0.1322596|18.28645727|25.71480629', '218|-1.865113245|22.00050569|0.132240418|18.32904183|25.77354888', '219|-1.860734944|22.05229242|0.13222933|18.37122369|25.83225207', '220|-1.85663384|22.10371305|0.132226801|18.41298696|25.89092687', '221|-1.852827186|22.15475603|0.132233201|18.45431794|25.94958116', '222|-1.849323204|22.20541249|0.132248993|18.49520062|26.00822631', '223|-1.846131607|22.255673|0.132274625|18.53561932|26.06687321', '224|-1.843261294|22.30552831|0.132310549|18.57555819|26.1255331', '225|-1.840720248|22.3549693|0.132357221|18.61500111|26.18421759', '226|-1.83851544|22.40398706|0.132415103|18.65393178|26.24293861', '227|-1.83665586|22.45257182|0.132484631|18.69233437|26.30170723', '228|-1.835138046|22.50071778|0.132566359|18.73019025|26.36053932', '229|-1.833972004|22.54841437|0.132660699|18.7674838|26.41944523', '230|-1.833157751|22.59565422|0.132768153|18.80419732|26.47843912', '231|-1.83269562|22.64242956|0.132889211|18.84031318|26.53753478', '232|-1.832584342|22.68873292|0.133024368|18.87581348|26.59674639', '233|-1.832820974|22.73455713|0.133174129|18.91067999|26.65608851', '234|-1.833400825|22.7798953|0.133338999|18.9448942|26.71557609', '235|-1.834317405|22.82474087|0.133519496|18.97843726|26.77522448', '236|-1.83555752|22.86908912|0.133716192|19.0112887|26.83505132', '237|-1.837119466|22.91293151|0.133929525|19.04343134|26.89506944', '238|-1.838987063|22.95626373|0.134160073|19.07484425|26.95529697', '239|-1.841146139|22.99908062|0.134408381|19.10550722|27.01575092', '240|-1.84233016|23.02029424|0.134539365|19.12055111|27.04606818');
	var female_bmi = new Array('24|-1.024496827|16.38804056|0.085025838|14.3801866|17.97371413', '25|-1.102698353|16.3189719|0.084214052|14.34527262|17.88748812', '26|-1.18396635|16.25207985|0.083455124|14.31096806|17.80489051', '27|-1.268071036|16.18734669|0.082748284|14.27727686|17.72586396', '28|-1.354751525|16.12475448|0.082092737|14.24420303|17.65035137', '29|-1.443689692|16.06428762|0.081487717|14.21174909|17.57829774', '30|-1.53454192|16.00593001|0.080932448|14.17991775|17.50964839', '31|-1.626928093|15.94966631|0.080426175|14.14871111|17.44434994', '32|-1.720434829|15.89548197|0.079968176|14.11813062|17.38235043', '33|-1.814635262|15.84336179|0.079557735|14.08817793|17.32359846', '34|-1.909076262|15.79329146|0.079194187|14.0588539|17.26804436', '35|-2.003296102|15.7452564|0.078876895|14.03015932|17.21563951', '36|-2.096828937|15.69924188|0.078605255|14.00209476|17.16633643', '37|-2.189211877|15.65523282|0.078378696|13.97466073|17.12008872', '38|-2.279991982|15.61321371|0.078196674|13.94785767|17.07685104', '39|-2.368732949|15.57316843|0.078058667|13.92168608|17.03657894', '40|-2.455021314|15.53508019|0.077964169|13.89614655|16.99922885', '41|-2.538471972|15.49893145|0.077912684|13.87123981|16.96475788', '42|-2.618732901|15.46470384|0.077903716|13.84696678|16.93312378', '43|-2.695488973|15.43237817|0.077936763|13.82332865|16.90428477', '44|-2.768464816|15.40193436|0.078011309|13.80032682|16.87819947', '45|-2.837426693|15.37335154|0.078126817|13.77796299|16.85482681', '46|-2.902178205|15.34660842|0.078282739|13.75623885|16.83412628', '47|-2.962580386|15.32168181|0.078478449|13.73515717|16.81605638', '48|-3.018521987|15.29854897|0.078713325|13.71472021|16.80057671', '49|-3.069936555|15.27718618|0.078986694|13.6949307|16.78764654', '50|-3.116795864|15.2575692|0.079297841|13.67579162|16.77722512', '51|-3.159107331|15.23967338|0.079646006|13.65730608|16.76927159', '52|-3.196911083|15.22347371|0.080030389|13.63947739|16.76374505', '53|-3.230276759|15.20894491|0.080450145|13.62230894|16.76060449', '54|-3.259300182|15.19606152|0.080904391|13.60580421|16.75980884', '55|-3.284099963|15.18479799|0.081392203|13.58996673|16.76131695', '56|-3.30481415|15.17512871|0.081912623|13.57480002|16.76508763', '57|-3.321596954|15.16702811|0.082464661|13.56030761|16.77107966', '58|-3.334615646|15.16047068|0.083047295|13.54649295|16.77925184', '59|-3.344047622|15.15543107|0.083659478|13.53335941|16.78956298', '60|-3.35007771|15.15188405|0.084300139|13.52091027|16.80197195', '61|-3.352893805|15.14980479|0.0849682|13.50914853|16.81643792', '62|-3.352691376|15.14916825|0.085662539|13.4980774|16.83291965', '63|-3.34966438|15.14994984|0.086382035|13.48769977|16.85137625', '64|-3.343998803|15.15212585|0.087125591|13.47801782|16.87176785', '65|-3.335889574|15.15567186|0.087892047|13.4690344|16.89405345', '66|-3.325522491|15.16056419|0.088680264|13.46075175|16.91819285', '67|-3.31307846|15.16677947|0.089489106|13.45317191|16.94414613', '68|-3.298732648|15.17429464|0.090317434|13.44629667|16.97187362', '69|-3.282653831|15.18308694|0.091164117|13.44012761|17.00133593', '70|-3.265003896|15.1931339|0.092028028|13.43466608|17.03249399', '71|-3.245937506|15.20441335|0.092908048|13.42991321|17.065309', '72|-3.225606516|15.21690296|0.093803033|13.42587042|17.09974172', '73|-3.204146115|15.2305815|0.094711916|13.42253788|17.13575468', '74|-3.181690237|15.24542745|0.095633595|13.41991629|17.17330968', '75|-3.158363475|15.26141966|0.096566992|13.41800595|17.21236911', '76|-3.134282833|15.27853728|0.097511046|13.41680692|17.25289572', '77|-3.109557879|15.29675967|0.09846471|13.41631905|17.29485256', '78|-3.084290931|15.31606644|0.099426955|13.41654198|17.33820304', '79|-3.058577292|15.33643745|0.100396769|13.41747514|17.38291092', '80|-3.032505499|15.35785274|0.101373159|13.41911775|17.42894029', '81|-3.0061576|15.38029261|0.10235515|13.42146884|17.4762556', '82|-2.979609448|15.40373754|0.103341788|13.42452722|17.52482162', '83|-2.952930993|15.42816819|0.104332139|13.42829152|17.57460349', '84|-2.926186592|15.45356545|0.105325289|13.43276016|17.6255667', '85|-2.899435307|15.47991037|0.106320346|13.43793139|17.67767708', '86|-2.872731211|15.50718419|0.10731644|13.44380325|17.7309008', '87|-2.846123683|15.53536829|0.108312721|13.45037362|17.78520438', '88|-2.819657704|15.56444426|0.109308364|13.45764018|17.8405547', '89|-2.793374145|15.5943938|0.110302563|13.46560044|17.89691898', '90|-2.767310047|15.6251988|0.111294537|13.47425174|17.95426475', '91|-2.741498897|15.65684126|0.112283526|13.48359125|18.01255992', '92|-2.715970894|15.68930333|0.113268793|13.49361598|18.07177271', '93|-2.690753197|15.7225673|0.114249622|13.50432278|18.13187166', '94|-2.665870146|15.75661555|0.115225321|13.51570835|18.19282565', '95|-2.641343436|15.79143062|0.116195218|13.52776922|18.25460388', '96|-2.617192204|15.82699517|0.117158667|13.54050176|18.31717594', '97|-2.593430614|15.86329241|0.118115073|13.55390172|18.38051241', '98|-2.570076037|15.90030484|0.119063807|13.56796556|18.44458291', '99|-2.547141473|15.93801545|0.12000429|13.58268918|18.50935798', '100|-2.524635245|15.97640787|0.120935994|13.59806788|18.57480931', '101|-2.502569666|16.01546483|0.121858355|13.61409768|18.6409074', '102|-2.48095189|16.05516984|0.12277087|13.63077388|18.70762408', '103|-2.459785573|16.09550688|0.123673085|13.6480912|18.77493214', '104|-2.439080117|16.13645881|0.124564484|13.6660455|18.84280276', '105|-2.418838304|16.17800955|0.125444639|13.68463148|18.91120897', '106|-2.399063683|16.22014281|0.126313121|13.70384401|18.98012366', '107|-2.379756861|16.26284277|0.127169545|13.72367745|19.04952063', '108|-2.360920527|16.30609316|0.128013515|13.74412656|19.11937316', '109|-2.342557728|16.34987759|0.128844639|13.7651862|19.18965453', '110|-2.324663326|16.39418118|0.129662637|13.78684956|19.26034062', '111|-2.307240716|16.43898741|0.130467138|13.80911155|19.33140487', '112|-2.290287663|16.48428082|0.131257852|13.83196589|19.4028226', '113|-2.273803847|16.53004554|0.132034479|13.85540667|19.47456869', '114|-2.257782149|16.57626713|0.132796819|13.87942647|19.54662051', '115|-2.242227723|16.62292864|0.133544525|13.90402053|19.6189515', '116|-2.227132805|16.67001572|0.134277436|13.92918106|19.69153965', '117|-2.212495585|16.71751288|0.134995324|13.95490163|19.7643612', '118|-2.19831275|16.76540496|0.135697996|13.98117536|19.83739314', '119|-2.184580762|16.81367689|0.136385276|14.00799522|19.91061278', '120|-2.171295888|16.86231366|0.137057004|14.03535405|19.98399779', '121|-2.158454232|16.91130036|0.137713039|14.06324456|20.05752615', '122|-2.146051754|16.96062216|0.138353254|14.0916593|20.13117619', '123|-2.134084303|17.0102643|0.138977537|14.12059071|20.20492657', '124|-2.122547629|17.06021213|0.139585795|14.15003106|20.27875629', '125|-2.111437411|17.11045106|0.140177947|14.17997251|20.35264468', '126|-2.100749266|17.16096656|0.140753927|14.21040706|20.42657139', '127|-2.090478774|17.21174424|0.141313686|14.2413266|20.50051644', '128|-2.080621484|17.26276973|0.141857186|14.27272286|20.57446015', '129|-2.071172932|17.31402878|0.142384404|14.30458743|20.64838321', '130|-2.062128649|17.3655072|0.142895332|14.33691178|20.72226661', '131|-2.053484173|17.4171909|0.143389972|14.36968723|20.79609169', '132|-2.045235058|17.46906585|0.143868341|14.40290497|20.86984014', '133|-2.03737688|17.52111811|0.144330469|14.43655605|20.94349396', '134|-2.029906684|17.57333347|0.144776372|14.47063181|21.01703489', '135|-2.022817914|17.62569869|0.145206138|14.50512237|21.09044653', '136|-2.016107084|17.67819987|0.145619819|14.54001862|21.16371155', '137|-2.009769905|17.7308234|0.146017491|14.57531107|21.2368133', '138|-2.003802134|17.78355575|0.146399239|14.61099007|21.30973548', '139|-1.998199572|17.83638347|0.146765161|14.64704584|21.38246211', '140|-1.992958064|17.88929321|0.147115364|14.68346846|21.45497756', '141|-1.988073505|17.94227168|0.147449967|14.72024789|21.52726655', '142|-1.983541835|17.9953057|0.147769097|14.75737391|21.5993141', '143|-1.979359041|18.04838216|0.148072891|14.7948362|21.6711056', '144|-1.975521156|18.10148804|0.148361495|14.83262428|21.74262677', '145|-1.972024258|18.15461039|0.148635067|14.87072753|21.81386368', '146|-1.968864465|18.20773639|0.148893769|14.90913518|21.88480271', '147|-1.966037938|18.26085325|0.149137776|14.94783635|21.95543061', '148|-1.963540872|18.31394832|0.14936727|14.98681999|22.02573445', '149|-1.961369499|18.36700902|0.149582439|15.0260749|22.09570166', '150|-1.959520079|18.42002284|0.149783482|15.06558978|22.16531999', '151|-1.9579889|18.47297739|0.149970604|15.10535314|22.23457754', '152|-1.956772271|18.52586035|0.15014402|15.14535337|22.30346276', '153|-1.95586652|18.57865951|0.15030395|15.18557871|22.37196443', '154|-1.955267984|18.63136275|0.150450621|15.22601726|22.44007167', '155|-1.954973011|18.68395801|0.15058427|15.26665697|22.50777397', '156|-1.954977947|18.73643338|0.150705138|15.30748565|22.57506113', '157|-1.955279136|18.788777|0.150813475|15.34849095|22.6419233', '158|-1.955872909|18.84097713|0.150909535|15.38966039|22.70835101', '159|-1.956755579|18.89302212|0.150993582|15.43098133|22.77433508', '160|-1.957923436|18.94490041|0.151065883|15.47244099|22.83986672', '161|-1.959372737|18.99660055|0.151126714|15.51402643|22.90493747', '162|-1.9610997|19.04811118|0.151176355|15.55572457|22.96953922', '163|-1.963100496|19.09942105|0.151215094|15.59752218|23.03366421', '164|-1.96537124|19.15051899|0.151243223|15.63940588|23.09730502', '165|-1.967907983|19.20139397|0.151261042|15.68136213|23.16045458', '166|-1.970706706|19.25203503|0.151268855|15.72337724|23.2231062', '167|-1.973763307|19.30243131|0.151266974|15.76543738|23.28525349', '168|-1.977073595|19.35257209|0.151255713|15.80752854|23.34689045', '169|-1.980633277|19.40244671|0.151235395|15.84963659|23.40801143', '170|-1.984437954|19.45204465|0.151206347|15.89174721|23.46861112', '171|-1.988483106|19.50135548|0.151168902|15.93384595|23.52868458', '172|-1.992764085|19.55036888|0.151123398|15.97591819|23.5882272', '173|-1.997276103|19.59907464|0.15107018|16.01794916|23.64723476', '174|-2.002014224|19.64746266|0.151009595|16.05992392|23.70570337', '175|-2.00697335|19.69552294|0.150942|16.10182739|23.76362952', '176|-2.012148213|19.7432456|0.150867753|16.14364432|23.82101004', '177|-2.017533363|19.79062086|0.150787221|16.1853593|23.87784214', '178|-2.023123159|19.83763907|0.150700774|16.22695676|23.93412338', '179|-2.028911755|19.88429066|0.150608788|16.26842096|23.98985168', '180|-2.034893091|19.9305662|0.150511645|16.30973602|24.04502533', '181|-2.041060881|19.97645636|0.150409731|16.35088587|24.09964299', '182|-2.047408604|20.02195192|0.15030344|16.3918543|24.15370368', '183|-2.05392949|20.06704377|0.150193169|16.43262492|24.20720678', '184|-2.060616513|20.11172291|0.150079322|16.47318119|24.26015204', '185|-2.067462375|20.15598047|0.149962308|16.5135064|24.3125396', '186|-2.074459502|20.19980767|0.14984254|16.55358366|24.36436993', '187|-2.081600029|20.24319586|0.149720441|16.59339594|24.41564391', '188|-2.088875793|20.28613648|0.149596434|16.63292602|24.46636278', '189|-2.096278323|20.32862109|0.149470953|16.67215653|24.51652812', '190|-2.103798828|20.37064138|0.149344433|16.71106993|24.56614194', '191|-2.111428194|20.41218911|0.149217319|16.74964852|24.61520657', '192|-2.119156972|20.45325617|0.14909006|16.78787442|24.66372475', '193|-2.126975375|20.49383457|0.14896311|16.82572959|24.71169957', '194|-2.134873266|20.5339164|0.148836931|16.86319583|24.75913451', '195|-2.142840157|20.57349387|0.148711989|16.90025476|24.80603342', '196|-2.150865204|20.61255929|0.148588757|16.93688787|24.85240053', '197|-2.158937201|20.65110506|0.148467715|16.97307644|24.89824041', '198|-2.167044578|20.6891237|0.148349348|17.00880162|24.94355805', '199|-2.175176987|20.72660728|0.14823412|17.04404492|24.98835785', '200|-2.183317362|20.76355011|0.148122614|17.07878553|25.03264836', '201|-2.191457792|20.79994337|0.148015249|17.11300574|25.07643282', '202|-2.199583649|20.83578051|0.147912564|17.14668547|25.11971866', '203|-2.207681525|20.87105449|0.147815078|17.17980508|25.16251271', '204|-2.215737645|20.90575839|0.147723315|17.21234472|25.20482218', '205|-2.223739902|20.93988477|0.147637768|17.24428517|25.24665348', '206|-2.231667995|20.97342858|0.147559083|17.27560407|25.28801794', '207|-2.239511942|21.00638171|0.147487716|17.30628297|25.32892108', '208|-2.247257081|21.0387374|0.14742421|17.33630159|25.3693713', '209|-2.254885145|21.07048996|0.147369174|17.36563825|25.40937929', '210|-2.26238209|21.10163241|0.147323144|17.39427286|25.44895346', '211|-2.269731517|21.13215845|0.147286698|17.42218439|25.48810377', '212|-2.276917229|21.16206171|0.147260415|17.44935184|25.52684029', '213|-2.283925442|21.1913351|0.147244828|17.47575509|25.56517184', '214|-2.290731442|21.21997472|0.147240683|17.50136974|25.603114', '215|-2.29732427|21.24797262|0.147248467|17.52617667|25.64067435', '216|-2.303687802|21.27532239|0.14726877|17.55015468|25.67786376', '217|-2.309799971|21.30201933|0.147302299|17.57328018|25.714697', '218|-2.315651874|21.32805489|0.147349514|17.59553468|25.75118107', '219|-2.32121731|21.35342563|0.147411215|17.61689275|25.7873338', '220|-2.326481911|21.37812462|0.147487979|17.63733356|25.82316611', '221|-2.331428139|21.40214589|0.147580453|17.6568349|25.85869115', '222|-2.336038473|21.42548351|0.147689289|17.67537444|25.89392241', '223|-2.34029545|21.44813156|0.14781515|17.69292976|25.92887369', '224|-2.344181703|21.47008412|0.147958706|17.70947829|25.96355908', '225|-2.34768|21.49133529|0.148120633|17.72499741|25.99799301', '226|-2.350773286|21.51187918|0.148301619|17.73946435|26.03219019', '227|-2.353444725|21.53170989|0.148502355|17.75285625|26.06616563', '228|-2.355677743|21.55082155|0.148723546|17.76515018|26.09993465', '229|-2.35745607|21.56920824|0.148965902|17.77632308|26.13351285', '230|-2.358763788|21.58686406|0.149230142|17.78635182|26.16691611', '231|-2.359585369|21.60378309|0.149516994|17.79521318|26.20016061', '232|-2.359905726|21.61995939|0.149827195|17.80288385|26.23326279', '233|-2.359710258|21.635387|0.150161492|17.80934044|26.26623937', '234|-2.358980464|21.65006126|0.150520734|17.81455755|26.29911039', '235|-2.357714508|21.6639727|0.150905439|17.81851675|26.33188509', '236|-2.355892424|21.67711736|0.151316531|17.82119134|26.36458581', '237|-2.353501353|21.68948935|0.151754808|17.82255737|26.39723077', '238|-2.350528726|21.70108288|0.152221086|17.8225906|26.42983873', '239|-2.346962247|21.71189225|0.152716206|17.82126653|26.4624291', '240|-2.34495843|21.71699934|0.152974718|17.82009046|26.47871966');

	this.male_data = {};
	this.female_data = {};

	// Convert those data string arrays into something meaningful
	for(var i = 0; i < male_bmi.length; i++) {
		var arr = male_bmi[i].split('|')

		for (var j = 0; j < arr.length; j++) {
			arr[j] = parseFloat(arr[j]);
		}

		this.male_data[arr[0]] = arr;
	}

	for(var i = 0; i < female_bmi.length; i++) {
		var arr = female_bmi[i].split('|');

		for (var j = 0; j < arr.length; j++) {
			arr[j] = parseFloat(arr[j]);
		}

		this.female_data[arr[0]] = arr;
	}
}

// Change the Unit of Measurement (US or Metric)
function changeMeasurementUnit(unit) {
	if(unit == "us") {
		document.getElementById("kh-bmicalc-unit-us").setAttribute("aria-checked", "true");
		document.getElementById("kh-bmicalc-unit-metric").setAttribute("aria-checked", "false");
		document.getElementById("kh-bmicalc-height-label").innerHTML = "Feet";
		document.getElementById("kh-bmicalc-height-label2").style.display = "block";
		document.getElementById("kh-bmicalc-height-in").style.display = "block";
		document.getElementById("kh-bmicalc-height-in").setAttribute("aria-required", "true");
		document.getElementById("kh-bmicalc-height-in").setAttribute("required", "true");
		document.getElementById("kh-bmicalc-weight-label").innerHTML = "Pounds";
	} else if(unit == "metric") {
		document.getElementById("kh-bmicalc-unit-us").setAttribute("aria-checked", "false");
		document.getElementById("kh-bmicalc-unit-metric").setAttribute("aria-checked", "true");
		document.getElementById("kh-bmicalc-height-label").innerHTML = "Centimeters";
		document.getElementById("kh-bmicalc-height-label2").style.display = "none";
		document.getElementById("kh-bmicalc-height-in").style.display = "none";
		document.getElementById("kh-bmicalc-height-in").setAttribute("aria-required", "false");
		document.getElementById("kh-bmicalc-height-in").removeAttribute("required");
		document.getElementById("kh-bmicalc-weight-label").innerHTML = "Kilograms";
	}
}

// Change the Gender (Male or Female)
function changeGender(gender) {
	if(gender == "male") {
		document.getElementById("kh-bmicalc-radio-sex-male").setAttribute("aria-checked", "true");
		document.getElementById("kh-bmicalc-radio-sex-female").setAttribute("aria-checked", "false");
	} else if(gender == "female") {
		document.getElementById("kh-bmicalc-radio-sex-male").setAttribute("aria-checked", "false");
		document.getElementById("kh-bmicalc-radio-sex-female").setAttribute("aria-checked", "true");
	}
}

// Validate the fields, calculate the BMI and display the results
function calculateBMI() {
	// Temporarily reset until the results are calculated
	document.getElementById("kh-bmicalc-results").style.display = "none";
	document.getElementById("kh-bmicalc-bmi-text").innerHTML = "";
	document.getElementById("kh-bmicalc-percentile-text").innerHTML = "";
	document.getElementById("kh-bmicalc-arrow-text").innerHTML = "";
	document.getElementById("kh-bmicalc-classification-text").innerHTML = "";
	document.getElementById("kh-bmicalc-arrow-area").style.marginLeft = "0";

	// Validate measurement units
	var radio_units = document.getElementsByName("kh-bmicalc-radio-measurement-unit");
	var measurement_unit = null;

	// Loop through radio button fields for measurement units
	for(var i = 0; i < radio_units.length; i++) {
		if(radio_units[i].checked) {
			measurement_unit = radio_units[i].value;
			break;
		}
	}

	// If the measurement unit field is invalid, display an error message
	if(measurement_unit == null) {
		for(var i = 0; i < radio_units.length; i++) {
			radio_units[i].setAttribute("aria-invalid", "true");
		}
	} else {
		for(var i = 0; i < radio_units.length; i++) {
			radio_units[i].setAttribute("aria-invalid", "false");
		}
	}

	// Validate gender field
	var radio_gender = document.getElementsByName("kh-bmicalc-gender");
	var gender = null;

	// Loop through radio button fields for gender
	for(var i = 0; i < radio_gender.length; i++) {
		if(radio_gender[i].checked) {
			gender = radio_gender[i].value;
			break;
		}
	}

	// If the gender field is invalid, display an error message
	if(gender == null) {
		//alert("Please select a gender for your child.");

		for(var i = 0; i < radio_gender.length; i++) {
			radio_gender[i].setAttribute("aria-invalid", "true");
		}
	} else {
		for(var i = 0; i < radio_gender.length; i++) {
			radio_gender[i].setAttribute("aria-invalid", "false");
		}
	}

	// Validate date of birth field
	var dob_month = document.getElementById("kh-bmicalc-dob-month").value;
	var dob_day = document.getElementById("kh-bmicalc-dob-day").value;
	var dob_year = document.getElementById("kh-bmicalc-dob-year").value;
	var age;

	// If the date of birth fields are set to the default, display an error message
	if(dob_month == "") {
		document.getElementById("kh-bmicalc-dob-month").setAttribute("aria-invalid", "true");
	} else {
		document.getElementById("kh-bmicalc-dob-month").setAttribute("aria-invalid", "false");
	}

	if(dob_day == "") {
		document.getElementById("kh-bmicalc-dob-day").setAttribute("aria-invalid", "true");
	} else {
		document.getElementById("kh-bmicalc-dob-day").setAttribute("aria-invalid", "false");
	}

	if(dob_year == "") {
		document.getElementById("kh-bmicalc-dob-year").setAttribute("aria-invalid", "true");
	} else {
		document.getElementById("kh-bmicalc-dob-year").setAttribute("aria-invalid", "false");
	}

	if(dob_month != "" && dob_day != "" && dob_year != "") {
		age = bc.computeAge(bc.getDateTimeObject(dob_year + "/" + dob_month), bc.getDateTimeObject(kh_current_year + "/" + kh_current_month));
	}

	// Validate height
	var height_ft = parseInt(document.getElementById("kh-bmicalc-height-ft").value);
	var height_in = parseInt(document.getElementById("kh-bmicalc-height-in").value);
	var height;

	// If the height field is invalid, display an error message
	if(measurement_unit == "metric") {
		if(height_ft != NaN) {
			height = height_ft;
		}
	} else {
		if(height_ft != NaN && height_in != NaN) {
			height = Math.round((height_ft * 12) + height_in);
		}
	}

	if(typeof(height) === 'number' && isNaN(height)) {
		if(measurement_unit == "metric") {
			document.getElementById("kh-bmicalc-height-ft").setAttribute("aria-invalid", "true");
			document.getElementById("kh-bmicalc-height-in").setAttribute("aria-invalid", "false");
		} else {
			document.getElementById("kh-bmicalc-height-ft").setAttribute("aria-invalid", "true");
			document.getElementById("kh-bmicalc-height-in").setAttribute("aria-invalid", "true");
		}
	} else {
		if(measurement_unit == "metric") {
			document.getElementById("kh-bmicalc-height-ft").setAttribute("aria-invalid", "false");
			document.getElementById("kh-bmicalc-height-in").setAttribute("aria-invalid", "false");
		} else {
			document.getElementById("kh-bmicalc-height-ft").setAttribute("aria-invalid", "false");
			document.getElementById("kh-bmicalc-height-in").setAttribute("aria-invalid", "false");
		}
	}

	// Validate weight
	var weight = parseInt(document.getElementById("kh-bmicalc-weight-lbs").value);

	if(weight == undefined || ((typeof(weight) === 'number' && isNaN(weight))) || weight <= 0) {
		document.getElementById("kh-bmicalc-weight-lbs").setAttribute("aria-invalid", "true");
	} else {
		document.getElementById("kh-bmicalc-weight-lbs").setAttribute("aria-invalid", "false");
	}

	// Display the Results
	if(measurement_unit != null && gender != null && age != null && height != NaN && weight != NaN) {
		
$('html,body').animate({
        scrollTop: $("#kh-bmicalc-btn-submit").offset().top},
        'slow');		
		
		var bmi_value;

		// Calculate the BMI
		if(measurement_unit == "us") {
			bmi_value = Math.round((weight * 703 * 10) / (height * height)) / 10;
		} else if(measurement_unit == "metric") {
			bmi_value = Math.round((weight / (height * height)) * 100000) / 10;
		}

		if(bmi_value != null && !(typeof(bmi_value) === 'number' && isNaN(bmi_value))) {
			// Get the BMI Percentile
			var isMale = (gender == "male") ? true : false;

			var bmi_percentile = percentileHelper.calculate(isMale, age, bmi_value);
			var bmi_percentile_string;

			// Format the percentile string
			if(bmi_percentile > 3 && bmi_percentile < 21) {
				bmi_percentile_string = "%";
			}

			switch(bmi_percentile % 10) {
				case 1:
					bmi_percentile_string = "%";
					//bmi_percentile_string = "%";
					break;
				case 2:
					bmi_percentile_string = "%";
					//bmi_percentile_string = "%";
					break;
				case 3:
					bmi_percentile_string = "%";
					//bmi_percentile_string = "%";
					break;
				default:
					bmi_percentile_string = "%";
					//bmi_percentile_string = "%";
					break;
			}

			// Populate BMI Calc Results
			document.getElementById("kh-bmicalc-bmi-text").innerHTML = bmi_value;
			document.getElementById("kh-bmicalc-percentile-text").innerHTML = bmi_percentile + bmi_percentile_string + "";
			document.getElementById("kh-bmicalc-arrow-text").innerHTML = bmi_percentile + "%";
			document.getElementById("kh-bmicalc-classification-text").innerHTML = percentileHelper.getBMIClassificationResponseText(bmi_percentile);
			document.getElementById("kh-bmicalc-arrow-area").style.marginLeft = bmi_percentile + "%";
			document.getElementById("kh-bmicalc-results").style.display = "block";
			document.getElementById("percentila").value = bmi_percentile;
			
		}
	}
}



// Reset the form data
function resetFormData() {
	// Reset back to US Measurements
	document.getElementById("kh-bmicalc-height-label").innerHTML = "Feet";
	document.getElementById("kh-bmicalc-height-label2").style.display = "block";
	document.getElementById("kh-bmicalc-height-in").style.display = "block";
	document.getElementById("kh-bmicalc-height-in").setAttribute("aria-required", "true");
	document.getElementById("kh-bmicalc-height-in").setAttribute("required", "true");
	document.getElementById("kh-bmicalc-weight-label").innerHTML = "Pounds";

	// Clear all the aria-invalid attributes
	document.getElementById("kh-bmicalc-unit-us").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-unit-metric").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-radio-sex-male").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-radio-sex-female").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-dob-month").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-dob-day").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-dob-year").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-height-ft").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-height-in").setAttribute("aria-invalid", "false");
	document.getElementById("kh-bmicalc-weight-lbs").setAttribute("aria-invalid", "false");

	// Reset BMI Results area
	document.getElementById("kh-bmicalc-results").style.display = "none";
	document.getElementById("kh-bmicalc-bmi-text").innerHTML = "";
	document.getElementById("kh-bmicalc-percentile-text").innerHTML = "";
	document.getElementById("kh-bmicalc-arrow-text").innerHTML = "";
	document.getElementById("kh-bmicalc-classification-text").innerHTML = "";
	document.getElementById("kh-bmicalc-arrow-area").style.marginLeft = "0";
}

// Initialize the BMI Calculator form
function initializeBMICalc() {
	bc = new BMICalculator;

	// Load the CSS
	var head = document.getElementsByTagName('head')[0];
	var link = document.createElement('link');

	link.type = "text/css";
	link.rel = "stylesheet";
	link.href = "//familysurvey.org/misc/javascript/js_apps/bmi-calculator/kh-bmicalc-style.css";
	link.media = "screen";

	head.appendChild(link);

	// Build the Calculator HTML
	theFullCalc = "<div class=\"kh-bmicalc-section\"><div class=\"kh-bmicalc-description\" style=\"display:none\"></div><div id=\"kh-bmicalc-panel\"><h4 id=\"kh-bmicalc-title\">Pentru 2-20 ani</h4><hr class=\"kh-bmicalc-divider\" /><div id=\"kh-bmicalc-form\"><fieldset style=\"display:none\"><div class=\"kh-bmicalc-field\" ><span><input type=\"radio\" id=\"kh-bmicalc-unit-metric\" name=\"kh-bmicalc-radio-measurement-unit\" onchange=\"changeMeasurementUnit('metric')\" aria-checked=\"true\"  value=\"metric\" checked=\"checked\" autocomplete=\"off\" /><label for=\"kh-bmicalc-unit-metric\">Metric (kg/cm)</label></span></div></fieldset><fieldset><legend class=\"kh-bmicalc-step-label\">1. Care este sexul copilului?</legend><div class=\"kh-bmicalc-field\"><input id=\"kh-bmicalc-radio-sex-male\"  name=\"kh-bmicalc-gender\" type=\"radio\" onchange=\"changeGender('male')\" aria-checked=\"false\" required=\"true\" aria-required=\"true\" value=\"male\" autocomplete=\"off\" /><label for=\"kh-bmicalc-radio-sex-male\">Masculin</label><input  id=\"kh-bmicalc-radio-sex-female\" name=\"kh-bmicalc-gender\" type=\"radio\" onchange=\"changeGender('female')\" aria-checked=\"false\" required=\"true\" aria-required=\"true\" value=\"female\" autocomplete=\"off\" /><label for=\"kh-bmicalc-radio-sex-female\">Feminin</label></div></fieldset><fieldset><legend class=\"kh-bmicalc-step-label\">2. Care este data nașterii?</legend><div class=\"kh-bmicalc-field\"><div class=\"kh-bmicalc-label-group\"><label for=\"kh-bmicalc-dob-day\">Zi</label><select class=\"kh-bmicalc-select\" id=\"kh-bmicalc-dob-day\" name=\"day\" required=\"true\" aria-required=\"true\" autocomplete=\"off\"><option value=\"\" selected=\"selected\"></option><option value=\"01\">01</option><option value=\"02\">02</option><option value=\"03\">03</option><option value=\"04\">04</option><option value=\"05\">05</option><option value=\"06\">06</option><option value=\"07\">07</option><option value=\"08\">08</option><option value=\"09\">09</option><option value=\"10\">10</option><option value=\"11\">11</option><option value=\"12\">12</option><option value=\"13\">13</option><option value=\"14\">14</option><option value=\"15\">15</option><option value=\"16\">16</option><option value=\"17\">17</option><option value=\"18\">18</option><option value=\"19\">19</option><option value=\"20\">20</option><option value=\"21\">21</option><option value=\"22\">22</option><option value=\"23\">23</option><option value=\"24\">24</option><option value=\"25\">25</option><option value=\"26\">26</option><option value=\"27\">27</option><option value=\"28\">28</option><option value=\"29\">29</option><option value=\"30\">30</option><option value=\"31\">31</option></select></div><div class=\"kh-bmicalc-label-group\"><label for=\"kh-bmicalc-dob-month\">Lună</label><select class=\"kh-bmicalc-select\" id=\"kh-bmicalc-dob-month\" name=\"month\" required=\"true\" aria-required=\"true\" autocomplete=\"off\"><option value=\"\" selected=\"selected\"></option><option value=\"01\">Ianuarie</option><option value=\"02\">Februarie</option><option value=\"03\">Martie</option><option value=\"04\">Aprilie</option><option value=\"05\">Mai</option><option value=\"06\">Iunie</option><option value=\"07\">Iulie</option><option value=\"08\">August</option><option value=\"09\">Septembrie</option><option value=\"10\">Octombrie</option><option value=\"11\">Noiembrie</option><option value=\"12\">Decembrie</option></select></div><div class=\"kh-bmicalc-label-group\"><label for=\"kh-bmicalc-dob-year\">An</label><select class=\"kh-bmicalc-select\" id=\"kh-bmicalc-dob-year\" name=\"year\" required=\"true\" aria-required=\"true\" autocomplete=\"off\"><option value=\"\" selected=\"selected\"></option></select></div></div></fieldset><br><div class=\"kh-bmicalc-step-label\" >3. Care este înălțimea copilului?</div><div class=\"kh-bmicalc-field\"><div  id=\"kh-bmi-feet-label\" class=\"kh-bmicalc-label-group\"><label id=\"kh-bmicalc-height-label\" for=\"kh-bmicalc-height-ft\">Centimetri</label><input type=\"text\" id=\"kh-bmicalc-height-ft\" name=\"kh-bmicalc-height-ft\" required=\"true\" aria-required=\"true\" value=\"\" autocomplete=\"off\" /></div><div style=\"display:none\" id=\"kh-bmi-inches-label\" class=\"kh-bmicalc-label-group\"><label id=\"kh-bmicalc-height-label2\" for=\"kh-bmicalc-height-in\" >Inches</label><input type=\"text\" id=\"kh-bmicalc-height-in\" name=\"kh-bmicalc-height-in\" aria-required=\"false\" value=\"\" autocomplete=\"off\" /></div></div><div class=\"kh-bmicalc-step-label\" >4. Cât cântărește copilul?</div><div class=\"kh-bmicalc-field\"><div class=\"kh-bmicalc-label-group\"><label id=\"kh-bmicalc-weight-label\" for=\"kh-bmicalc-weight-lbs\">Kilograme</label><input type=\"text\" id=\"kh-bmicalc-weight-lbs\" name=\"kh-bmicalc-weight-lbs\" required=\"true\" aria-required=\"true\" value=\"\" autocomplete=\"off\" /></div></div><div class=\"kh-bmicalc-btn-area\"><button style=\"display:none\" type=\"reset\" id=\"kh-bmicalc-btn-reset\">Reset</button><button type=\"submit\" id=\"kh-bmicalc-btn-submit\">Calculează</button></div></div><div id=\"kh-bmicalc-results\"><h5>Rezultate</h5><div id=\"kh-bmicalc-results-description\" aria-live=\"polite\"><p>Copilul are un IMC de <strong id=\"kh-bmicalc-bmi-text\"></strong>. Acesta se asociază percentilei <strong id=\"kh-bmicalc-percentile-text\"></strong> care indică <strong id=\"kh-bmicalc-classification-text\"></strong>.</p></div><div id=\"kh-bmicalc-results-graph-area\"><div id=\"kh-bmicalc-arrow-area\" style=\"display:none\"><span id=\"kh-bmicalc-arrow-text\"></span></div><div id=\"kh-bmicalc-results-graph\" style=\"display:none\"></div><div id=\"kh-bmicalc-results-labels\" style=\"display:none\"><span id=\"kh-bmicalc-results-start-label\">5th</span><span id=\"kh-bmicalc-results-end-label\">95th</span></div></div></div></div></div>";

	// Initialize the BMI Calculator
	document.write(theFullCalc);

	// Date of Birth - Year Dropdown Select
	var birth_year_select = document.getElementById("kh-bmicalc-dob-year");

	for(var i = 0; i <= 18; i++) {
		var birth_year_obj = document.createElement("option");
		birth_year_obj.value = (kh_current_year - i) - 2;
		birth_year_obj.innerHTML = (kh_current_year - i) - 2;

		birth_year_select.appendChild(birth_year_obj);
	}

	// Event listeners when the form is submitted or reset
	document.getElementById("kh-bmicalc-btn-submit").addEventListener("click", function(e) { e.preventDefault(); calculateBMI(); });
	document.getElementById("kh-bmicalc-btn-reset").addEventListener("click", resetFormData);
}

initializeBMICalc();

</script>

